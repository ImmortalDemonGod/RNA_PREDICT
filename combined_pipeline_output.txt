RNA Pipeline Combined Output
Generated on: 2025-05-01 11:12:13
Using standardized test sequence: ACGUACGU
================================================================================


================================================================================
Output from: pipeline/stageA/run_stageA.py
Timestamp: 2025-05-01 11:12:13
================================================================================

STDOUT:
[2025-05-01 11:12:14,730][rna_predict.pipeline.stageA.run_stageA][INFO] - Starting Stage A pipeline with Hydra config
[2025-05-01 11:12:14,743][rna_predict.pipeline.stageA.run_stageA][INFO] - Config:
sequence: ${test_data.sequence}
device: cpu
seed: 42
atoms_per_residue: 44
run_stageD: true
enable_stageC: true
merge_latent: true
pipeline:
  verbose: true
  save_intermediates: true
  output_dir: outputs
  ignore_nan_values: true
  nan_replacement_value: 0.0
data:
  index_csv: ./data/index.csv
  root_dir: ./data/
  max_residues: 512
  max_atoms: 4096
  C_element: 128
  C_char: 256
  batch_size: 4
  num_workers: 8
  load_adj: false
  load_ang: false
model:
  stageA:
    num_hidden: 128
    dropout: 0.3
    min_seq_length: 80
    device: cpu
    checkpoint_path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
    checkpoint_url: https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1
    checkpoint_zip_path: RFold/checkpoints.zip
    batch_size: 32
    lr: 0.001
    threshold: 0.5
    debug_logging: true
    freeze_params: true
    run_example: true
    example_sequence: AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC
    visualization:
      enabled: true
      varna_jar_path: tools/varna-3-93.jar
      resolution: 8.0
      output_path: test_seq.png
    model:
      conv_channels:
      - 64
      - 128
      - 256
      - 512
      residual: true
      c_in: 1
      c_out: 1
      c_hid: 32
      seq2map:
        input_dim: 4
        max_length: 3000
        attention_heads: 8
        attention_dropout: 0.1
        positional_encoding: true
        query_key_dim: 128
        expansion_factor: 2.0
        heads: 1
      decoder:
        up_conv_channels:
        - 256
        - 128
        - 64
        skip_connections: true
  stageC:
    enabled: true
    method: mp_nerf
    do_ring_closure: false
    place_bases: true
    sugar_pucker: C3'-endo
    device: cpu
    debug_logging: true
    angle_representation: degrees
    use_metadata: false
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
  stageB:
    torsion_bert:
      model_name_or_path: sayby/rna_torsionbert
      device: ${device}
      angle_mode: sin_cos
      num_angles: 7
      max_length: 512
      checkpoint_path: null
      debug_logging: true
      init_from_scratch: false
      lora:
        enabled: false
        r: 8
        alpha: 16
        dropout: 0.1
        target_modules:
        - query
        - value
    pairformer:
      n_blocks: 1
      n_heads: 1
      c_z: 2
      c_s: 2
      c_token: 384
      c_atom: 128
      c_pair: 32
      dropout: 0.0
      freeze_params: false
      device: ${device}
      protenix_integration:
        c_token: 449
        restype_dim: 32
        profile_dim: 32
        c_atom: 128
        c_pair: 32
        num_heads: 4
        num_layers: 3
        r_max: 32
        s_max: 2
        use_optimized: false
        device: ${device}
      msa:
        c_m: 2
        c: 2
        c_z: 2
        dropout: 0.0
        n_blocks: 1
        enable: false
        strategy: random
        train_cutoff: 1
        test_cutoff: 1
        train_lowerb: 1
        test_lowerb: 1
        n_heads: 1
        pair_dropout: 0.0
        c_s_inputs: 2
        blocks_per_ckpt: 1
        input_feature_dims:
          msa: 2
          has_deletion: 1
          deletion_value: 1
      template:
        n_blocks: 1
        c: 2
        c_z: 2
        dropout: 0.0
        blocks_per_ckpt: null
        input_feature_dims:
          feature1:
            template_distogram: 1
            b_template_backbone_frame_mask: 1
            template_unit_vector: 1
            b_template_pseudo_beta_mask: 1
          feature2:
            template_restype_i: 1
            template_restype_j: 1
        distogram:
          max_bin: 1
          min_bin: 1
          no_bins: 1
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      c_hidden_mul: 1
      c_hidden_pair_att: 2
      no_heads_pair: 1
      init_z_from_adjacency: false
      debug_logging: false
      lora:
        enabled: false
        r: 1
        alpha: 1
        dropout: 0.0
        target_modules:
        - query
        - value
  stageD:
    enabled: true
    mode: ${stageD_diffusion.diffusion.mode}
    device: ${stageD_diffusion.diffusion.device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      num_layers: 6
      num_heads: 8
      dropout: 0.1
      coord_eps: 1.0e-06
      coord_min: -10000.0
      coord_max: 10000.0
      coord_similarity_rtol: 0.001
      test_residues_per_batch: 25
      sigma_data: 1.0
    transformer:
      n_blocks: ${stageD_diffusion.diffusion.transformer.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.transformer.n_heads}
      blocks_per_ckpt: ${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}
    atom_encoder:
      c_in: ${stageD_diffusion.diffusion.atom_encoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_encoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_encoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_encoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_encoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_encoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_encoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_encoder.n_keys}
    atom_decoder:
      c_in: ${stageD_diffusion.diffusion.atom_decoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_decoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_decoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_decoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_decoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_decoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_decoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_decoder.n_keys}
    diffusion:
      enabled: true
      mode: inference
      device: ${device}
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      test_residues_per_batch: 2
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
        num_layers: 6
        num_heads: 8
        dropout: 0.1
        coord_eps: 1.0e-06
        coord_min: -10000.0
        coord_max: 10000.0
        coord_similarity_rtol: 0.001
        test_residues_per_batch: 25
      transformer:
        n_blocks: 2
        n_heads: 2
        blocks_per_ckpt: null
      atom_encoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      atom_decoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      noise_schedule:
        schedule_type: linear
        s_max: 1.0
        s_min: 0.01
        p: 0.5
        p_mean: 0.0
        p_std: 1.0
      inference:
        num_steps: 2
        temperature: 1.0
        use_ddim: true
        sampling:
          num_samples: 1
          gamma0: 0.8
          gamma_min: 1.0
          noise_scale_lambda: 1.003
          step_scale_eta: 1.5
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      init_from_scratch: false
      feature_dimensions:
        c_s: 8
        c_s_inputs: 8
        c_sing: 8
        s_trunk: 8
        s_inputs: 8
    input_features: null
  protenix_integration:
    device: ${device}
    c_token: 449
    restype_dim: 32
    profile_dim: 32
    c_atom: 128
    c_pair: 32
    num_heads: 4
    num_layers: 3
    r_max: 32
    s_max: 2
    use_optimized: false
stageD_diffusion:
  enabled: true
  debug_logging: true
  ref_element_size: 128
  ref_atom_name_chars_size: 256
  profile_size: 32
  model_architecture:
    c_token: 8
    c_s: 8
    c_z: 4
    c_s_inputs: 8
    c_atom: 4
    c_atompair: 4
    c_noise_embedding: 4
    sigma_data: 1.0
  diffusion:
    init_from_scratch: false
    enabled: true
    mode: inference
    device: ${device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    feature_dimensions:
      c_s: 8
      c_s_inputs: 8
      c_sing: 8
      s_trunk: 8
      s_inputs: 8
    test_residues_per_batch: 2
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      sigma_data: 1.0
    transformer:
      n_blocks: 2
      n_heads: 2
      blocks_per_ckpt: null
    atom_encoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    atom_decoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    noise_schedule:
      schedule_type: linear
      s_max: 1.0
      s_min: 0.01
      p: 0.5
      p_mean: 0.0
      p_std: 1.0
    inference:
      num_steps: 2
      temperature: 1.0
      use_ddim: true
      sampling:
        num_samples: 1
        gamma0: 0.8
        gamma_min: 1.0
        noise_scale_lambda: 1.003
        step_scale_eta: 1.5
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
test_data:
  sequence: ACGUACGU
  sequence_length: 8
  atoms_per_residue: 44
  adjacency_fill_value: 1.0
  target_dim: 3
  torsion_angle_dim: 7
  embedding_dims:
    s_trunk: 384
    z_trunk: 128
    s_inputs: 449
  sequence_path: ${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv
  data_index: ./rna_predict/dataset/examples/kaggle_minimal_index.csv
  target_id: 1SCL_A
  model:
    stageD:
      enabled: true
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
      diffusion:
        init_from_scratch: false
        enabled: true
        mode: inference
        device: ${device}
        debug_logging: true
        ref_element_size: 128
        ref_atom_name_chars_size: 256
        profile_size: 32
        feature_dimensions:
          c_s: 8
          c_s_inputs: 8
          c_sing: 8
          s_trunk: 8
          s_inputs: 8
        test_residues_per_batch: 2
        model_architecture:
          c_token: 8
          c_s: 8
          c_z: 4
          c_s_inputs: 8
          c_atom: 4
          c_atompair: 4
          c_noise_embedding: 4
          sigma_data: 1.0
        transformer:
          n_blocks: 2
          n_heads: 2
          blocks_per_ckpt: null
        atom_encoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        atom_decoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        noise_schedule:
          schedule_type: linear
          s_max: 1.0
          s_min: 0.01
          p: 0.5
          p_mean: 0.0
          p_std: 1.0
        inference:
          num_steps: 2
          temperature: 1.0
          use_ddim: true
          sampling:
            num_samples: 1
            gamma0: 0.8
            gamma_min: 1.0
            noise_scale_lambda: 1.003
            step_scale_eta: 1.5
        use_memory_efficient_kernel: false
        use_deepspeed_evo_attention: false
        use_lma: false
        inplace_safe: false
        chunk_size: null

[2025-05-01 11:12:14,756][rna_predict.pipeline.stageA.run_stageA][INFO] - [Hydra Config] Full config:
sequence: ${test_data.sequence}
device: cpu
seed: 42
atoms_per_residue: 44
run_stageD: true
enable_stageC: true
merge_latent: true
pipeline:
  verbose: true
  save_intermediates: true
  output_dir: outputs
  ignore_nan_values: true
  nan_replacement_value: 0.0
data:
  index_csv: ./data/index.csv
  root_dir: ./data/
  max_residues: 512
  max_atoms: 4096
  C_element: 128
  C_char: 256
  batch_size: 4
  num_workers: 8
  load_adj: false
  load_ang: false
model:
  stageA:
    num_hidden: 128
    dropout: 0.3
    min_seq_length: 80
    device: cpu
    checkpoint_path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
    checkpoint_url: https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1
    checkpoint_zip_path: RFold/checkpoints.zip
    batch_size: 32
    lr: 0.001
    threshold: 0.5
    debug_logging: true
    freeze_params: true
    run_example: true
    example_sequence: AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC
    visualization:
      enabled: true
      varna_jar_path: tools/varna-3-93.jar
      resolution: 8.0
      output_path: test_seq.png
    model:
      conv_channels:
      - 64
      - 128
      - 256
      - 512
      residual: true
      c_in: 1
      c_out: 1
      c_hid: 32
      seq2map:
        input_dim: 4
        max_length: 3000
        attention_heads: 8
        attention_dropout: 0.1
        positional_encoding: true
        query_key_dim: 128
        expansion_factor: 2.0
        heads: 1
      decoder:
        up_conv_channels:
        - 256
        - 128
        - 64
        skip_connections: true
  stageC:
    enabled: true
    method: mp_nerf
    do_ring_closure: false
    place_bases: true
    sugar_pucker: C3'-endo
    device: cpu
    debug_logging: true
    angle_representation: degrees
    use_metadata: false
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
  stageB:
    torsion_bert:
      model_name_or_path: sayby/rna_torsionbert
      device: ${device}
      angle_mode: sin_cos
      num_angles: 7
      max_length: 512
      checkpoint_path: null
      debug_logging: true
      init_from_scratch: false
      lora:
        enabled: false
        r: 8
        alpha: 16
        dropout: 0.1
        target_modules:
        - query
        - value
    pairformer:
      n_blocks: 1
      n_heads: 1
      c_z: 2
      c_s: 2
      c_token: 384
      c_atom: 128
      c_pair: 32
      dropout: 0.0
      freeze_params: false
      device: ${device}
      protenix_integration:
        c_token: 449
        restype_dim: 32
        profile_dim: 32
        c_atom: 128
        c_pair: 32
        num_heads: 4
        num_layers: 3
        r_max: 32
        s_max: 2
        use_optimized: false
        device: ${device}
      msa:
        c_m: 2
        c: 2
        c_z: 2
        dropout: 0.0
        n_blocks: 1
        enable: false
        strategy: random
        train_cutoff: 1
        test_cutoff: 1
        train_lowerb: 1
        test_lowerb: 1
        n_heads: 1
        pair_dropout: 0.0
        c_s_inputs: 2
        blocks_per_ckpt: 1
        input_feature_dims:
          msa: 2
          has_deletion: 1
          deletion_value: 1
      template:
        n_blocks: 1
        c: 2
        c_z: 2
        dropout: 0.0
        blocks_per_ckpt: null
        input_feature_dims:
          feature1:
            template_distogram: 1
            b_template_backbone_frame_mask: 1
            template_unit_vector: 1
            b_template_pseudo_beta_mask: 1
          feature2:
            template_restype_i: 1
            template_restype_j: 1
        distogram:
          max_bin: 1
          min_bin: 1
          no_bins: 1
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      c_hidden_mul: 1
      c_hidden_pair_att: 2
      no_heads_pair: 1
      init_z_from_adjacency: false
      debug_logging: false
      lora:
        enabled: false
        r: 1
        alpha: 1
        dropout: 0.0
        target_modules:
        - query
        - value
  stageD:
    enabled: true
    mode: ${stageD_diffusion.diffusion.mode}
    device: ${stageD_diffusion.diffusion.device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      num_layers: 6
      num_heads: 8
      dropout: 0.1
      coord_eps: 1.0e-06
      coord_min: -10000.0
      coord_max: 10000.0
      coord_similarity_rtol: 0.001
      test_residues_per_batch: 25
      sigma_data: 1.0
    transformer:
      n_blocks: ${stageD_diffusion.diffusion.transformer.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.transformer.n_heads}
      blocks_per_ckpt: ${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}
    atom_encoder:
      c_in: ${stageD_diffusion.diffusion.atom_encoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_encoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_encoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_encoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_encoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_encoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_encoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_encoder.n_keys}
    atom_decoder:
      c_in: ${stageD_diffusion.diffusion.atom_decoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_decoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_decoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_decoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_decoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_decoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_decoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_decoder.n_keys}
    diffusion:
      enabled: true
      mode: inference
      device: ${device}
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      test_residues_per_batch: 2
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
        num_layers: 6
        num_heads: 8
        dropout: 0.1
        coord_eps: 1.0e-06
        coord_min: -10000.0
        coord_max: 10000.0
        coord_similarity_rtol: 0.001
        test_residues_per_batch: 25
      transformer:
        n_blocks: 2
        n_heads: 2
        blocks_per_ckpt: null
      atom_encoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      atom_decoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      noise_schedule:
        schedule_type: linear
        s_max: 1.0
        s_min: 0.01
        p: 0.5
        p_mean: 0.0
        p_std: 1.0
      inference:
        num_steps: 2
        temperature: 1.0
        use_ddim: true
        sampling:
          num_samples: 1
          gamma0: 0.8
          gamma_min: 1.0
          noise_scale_lambda: 1.003
          step_scale_eta: 1.5
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      init_from_scratch: false
      feature_dimensions:
        c_s: 8
        c_s_inputs: 8
        c_sing: 8
        s_trunk: 8
        s_inputs: 8
    input_features: null
  protenix_integration:
    device: ${device}
    c_token: 449
    restype_dim: 32
    profile_dim: 32
    c_atom: 128
    c_pair: 32
    num_heads: 4
    num_layers: 3
    r_max: 32
    s_max: 2
    use_optimized: false
stageD_diffusion:
  enabled: true
  debug_logging: true
  ref_element_size: 128
  ref_atom_name_chars_size: 256
  profile_size: 32
  model_architecture:
    c_token: 8
    c_s: 8
    c_z: 4
    c_s_inputs: 8
    c_atom: 4
    c_atompair: 4
    c_noise_embedding: 4
    sigma_data: 1.0
  diffusion:
    init_from_scratch: false
    enabled: true
    mode: inference
    device: ${device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    feature_dimensions:
      c_s: 8
      c_s_inputs: 8
      c_sing: 8
      s_trunk: 8
      s_inputs: 8
    test_residues_per_batch: 2
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      sigma_data: 1.0
    transformer:
      n_blocks: 2
      n_heads: 2
      blocks_per_ckpt: null
    atom_encoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    atom_decoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    noise_schedule:
      schedule_type: linear
      s_max: 1.0
      s_min: 0.01
      p: 0.5
      p_mean: 0.0
      p_std: 1.0
    inference:
      num_steps: 2
      temperature: 1.0
      use_ddim: true
      sampling:
        num_samples: 1
        gamma0: 0.8
        gamma_min: 1.0
        noise_scale_lambda: 1.003
        step_scale_eta: 1.5
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
test_data:
  sequence: ACGUACGU
  sequence_length: 8
  atoms_per_residue: 44
  adjacency_fill_value: 1.0
  target_dim: 3
  torsion_angle_dim: 7
  embedding_dims:
    s_trunk: 384
    z_trunk: 128
    s_inputs: 449
  sequence_path: ${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv
  data_index: ./rna_predict/dataset/examples/kaggle_minimal_index.csv
  target_id: 1SCL_A
  model:
    stageD:
      enabled: true
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
      diffusion:
        init_from_scratch: false
        enabled: true
        mode: inference
        device: ${device}
        debug_logging: true
        ref_element_size: 128
        ref_atom_name_chars_size: 256
        profile_size: 32
        feature_dimensions:
          c_s: 8
          c_s_inputs: 8
          c_sing: 8
          s_trunk: 8
          s_inputs: 8
        test_residues_per_batch: 2
        model_architecture:
          c_token: 8
          c_s: 8
          c_z: 4
          c_s_inputs: 8
          c_atom: 4
          c_atompair: 4
          c_noise_embedding: 4
          sigma_data: 1.0
        transformer:
          n_blocks: 2
          n_heads: 2
          blocks_per_ckpt: null
        atom_encoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        atom_decoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        noise_schedule:
          schedule_type: linear
          s_max: 1.0
          s_min: 0.01
          p: 0.5
          p_mean: 0.0
          p_std: 1.0
        inference:
          num_steps: 2
          temperature: 1.0
          use_ddim: true
          sampling:
            num_samples: 1
            gamma0: 0.8
            gamma_min: 1.0
            noise_scale_lambda: 1.003
            step_scale_eta: 1.5
        use_memory_efficient_kernel: false
        use_deepspeed_evo_attention: false
        use_lma: false
        inplace_safe: false
        chunk_size: null

[2025-05-01 11:12:14,756][rna_predict.pipeline.stageA.run_stageA][INFO] - [Hydra Config] Loaded Stage A config:
{'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}
[2025-05-01 11:12:14,964][rna_predict.pipeline.stageA.run_stageA][INFO] - [Info] File already exists and is valid zip, skipping download: RFold/checkpoints.zip
[2025-05-01 11:12:14,965][rna_predict.pipeline.stageA.run_stageA][INFO] - [Unzip] Extracting RFold/checkpoints.zip into RFold
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.run_stageA][INFO] - [Device] Using device: cpu
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Initializing StageARFoldPredictor...
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Device: cpu
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Checkpoint path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Example sequence length: 352
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Freeze params: True
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Run example: True
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-001] Effective debug_logging in StageARFoldPredictor.__init__: True
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-002] logger.level: 10
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-003] logger.handlers: [<StreamHandler <stderr> (DEBUG)>]
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-004] Handler 0 level: 10
[2025-05-01 11:12:15,217][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [INFO] self.device after torch.device: cpu
[2025-05-01 11:12:15,218][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Loading checkpoint from RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:15,233][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Checkpoint loaded successfully.
[2025-05-01 11:12:15,234][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [StageA] All model parameters frozen (requires_grad=False) per freeze_params config.
[2025-05-01 11:12:15,234][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] After super().__init__
[2025-05-01 11:12:15,234][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] Memory usage: 222.53 MB
[2025-05-01 11:12:15,235][rna_predict.pipeline.stageA.run_stageA][INFO] - [Example] Running inference on standardized test sequence: ACGUACGU (length: 8)
[2025-05-01 11:12:15,235][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Predicting adjacency for sequence length: 8
[2025-05-01 11:12:15,235][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Entered _create_sequence_tensor with device: cpu
[2025-05-01 11:12:15,235][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Creating tensor on CPU with device: cpu
[2025-05-01 11:12:15,242][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Tensor device after creation (patched): cpu, shape: torch.Size([1, 80])
[2025-05-01 11:12:15,242][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Output tensor device: cpu, shape: torch.Size([1, 80]), dtype: torch.int64
[2025-05-01 11:12:15,242][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] seq_tensor.device: cpu
[2025-05-01 11:12:15,242][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] self.model.device: cpu
[2025-05-01 11:12:15,242][rna_predict.pipeline.stageA.adjacency.rfold_predictor][WARNING] - [UNIQUE-WARN-STAGEA-FORWARD] Error in model forward pass: 'Module' object has no attribute 'shape'
[2025-05-01 11:12:15,245][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix shape: (8, 8)
[2025-05-01 11:12:15,245][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix data type: float32
[2025-05-01 11:12:15,245][rna_predict.pipeline.stageA.run_stageA][INFO] - [Example] Adjacency shape: (8, 8)
[2025-05-01 11:12:15,246][rna_predict.pipeline.stageA.run_stageA][INFO] - [Visualization] Attempting with JAR: tools/varna-3-93.jar
[2025-05-01 11:12:15,246][rna_predict.pipeline.stageA.run_stageA][WARNING] - [Warning] VARNA JAR not found at: tools/varna-3-93.jar -> skipping visualization.
STDERR:
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Initializing StageARFoldPredictor...
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Device: cpu
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Checkpoint path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Example sequence length: 352
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Freeze params: True
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Run example: True
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-001] Effective debug_logging in StageARFoldPredictor.__init__: True
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-002] logger.level: 10
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-003] logger.handlers: [<StreamHandler <stderr> (DEBUG)>]
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-004] Handler 0 level: 10
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [INFO] self.device after torch.device: cpu
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Loading checkpoint from RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Checkpoint loaded successfully.
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [StageA] All model parameters frozen (requires_grad=False) per freeze_params config.
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] After super().__init__
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] Memory usage: 222.53 MB
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Predicting adjacency for sequence length: 8
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Entered _create_sequence_tensor with device: cpu
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Creating tensor on CPU with device: cpu
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Tensor device after creation (patched): cpu, shape: torch.Size([1, 80])
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Output tensor device: cpu, shape: torch.Size([1, 80]), dtype: torch.int64
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] seq_tensor.device: cpu
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] self.model.device: cpu
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][WARNING] - [UNIQUE-WARN-STAGEA-FORWARD] Error in model forward pass: 'Module' object has no attribute 'shape'
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix shape: (8, 8)
[2025-05-01 11:12:15][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix data type: float32


================================================================================
Output from: pipeline/stageB/main.py
Timestamp: 2025-05-01 11:12:15
================================================================================

STDOUT:
[2025-05-01 11:12:16,456] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to mps (auto detect)
[2025-05-01 11:12:20,157][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Initializing StageARFoldPredictor...
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Device: cpu
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Checkpoint path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Example sequence length: 352
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Freeze params: True
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Run example: True
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-001] Effective debug_logging in StageARFoldPredictor.__init__: True
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-002] logger.level: 10
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-003] logger.handlers: [<StreamHandler <stderr> (DEBUG)>]
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-004] Handler 0 level: 10
[2025-05-01 11:12:20,158][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [INFO] self.device after torch.device: cpu
[2025-05-01 11:12:20,159][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Loading checkpoint from RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:20,278][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Checkpoint loaded successfully.
[2025-05-01 11:12:20,278][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [StageA] All model parameters frozen (requires_grad=False) per freeze_params config.
[2025-05-01 11:12:20,278][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] After super().__init__
[2025-05-01 11:12:20,278][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] Memory usage: 366.87 MB
[2025-05-01 11:12:20,278][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Predicting adjacency for sequence length: 8
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Entered _create_sequence_tensor with device: cpu
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Creating tensor on CPU with device: cpu
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Tensor device after creation (patched): cpu, shape: torch.Size([1, 80])
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Output tensor device: cpu, shape: torch.Size([1, 80]), dtype: torch.int64
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] seq_tensor.device: cpu
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] self.model.device: cpu
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][WARNING] - [UNIQUE-WARN-STAGEA-FORWARD] Error in model forward pass: 'Module' object has no attribute 'shape'
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix shape: (8, 8)
[2025-05-01 11:12:20,279][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix data type: float32
[2025-05-01 11:12:20,281][rna_predict.pipeline.stageB.torsion.torsion_bert_predictor][WARNING] - [UNIQUE-WARN-TORSIONBERT-DUMMYMODE] Config missing or incomplete, entering dummy mode and returning dummy tensors.
[2025-05-01 11:12:20,281][rna_predict.pipeline.stageB.torsion.torsion_bert_predictor][WARNING] - [UNIQUE-WARN-TORSIONBERT-DUMMYMODE] Returning dummy tensors for sequence of length 8 and dim 14.
[2025-05-01 11:12:20,281][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] Initializing StageCReconstruction
[2025-05-01 11:12:20,281][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] Memory usage: 368.84 MB
[2025-05-01 11:12:20,281][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] After super().__init__
[2025-05-01 11:12:20,281][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] Memory usage: 368.84 MB
[2025-05-01 11:12:20,281][rna_predict.pipeline.stageB.torsion.torsion_bert_predictor][WARNING] - [UNIQUE-WARN-TORSIONBERT-DUMMYMODE] Config missing or incomplete, entering dummy mode and returning dummy tensors.
[2025-05-01 11:12:20,282][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - Initializing PairformerWrapper...
[2025-05-01 11:12:20,282][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [MEMORY-LOG][StageB-Pairformer] Memory usage: 368.84 MB
[2025-05-01 11:12:20,282][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][WARNING] - Pairformer config missing required keys, entering dummy mode
[2025-05-01 11:12:20,283][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [UNIQUE-INFO-STAGEB-PAIRFORMER-TEST] PairformerWrapper initialized
[2025-05-01 11:12:20,283][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - Initializing Pairformer wrapper with device: cpu
[2025-05-01 11:12:20,283][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][WARNING] - 'use_checkpoint' not found in config, defaulting to False
[2025-05-01 11:12:20,297][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [MEMORY-LOG][StageB-Pairformer] After super().__init__
[2025-05-01 11:12:20,297][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [MEMORY-LOG][StageB-Pairformer] Memory usage: 370.75 MB
[2025-05-01 11:12:20,299][rna_predict.pipeline.stageB.main][INFO] - TorsionBERT predictor is in dummy mode, skipping model.zero_grad()
[2025-05-01 11:12:20,300][rna_predict.pipeline.stageB.torsion.torsion_bert_predictor][WARNING] - [UNIQUE-WARN-TORSIONBERT-DUMMYMODE] Returning dummy tensors for sequence of length 8 and dim 14.
STDERR:
W0501 11:12:17.243000 8603700288 torch/distributed/elastic/multiprocessing/redirects.py:27] NOTE: Redirects are currently not supported in Windows or MacOs.
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Initializing StageARFoldPredictor...
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Device: cpu
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Checkpoint path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Example sequence length: 352
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Freeze params: True
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] -   Run example: True
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-001] Effective debug_logging in StageARFoldPredictor.__init__: True
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-002] logger.level: 10
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-003] logger.handlers: [<StreamHandler <stderr> (DEBUG)>]
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-INST-STAGEA-004] Handler 0 level: 10
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [INFO] self.device after torch.device: cpu
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Loading checkpoint from RFold/checkpoints/RNAStralign_trainset_pretrained.pth
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [Load] Checkpoint loaded successfully.
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [StageA] All model parameters frozen (requires_grad=False) per freeze_params config.
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] After super().__init__
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - [MEMORY-LOG][StageA] Memory usage: 366.87 MB
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Predicting adjacency for sequence length: 8
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Entered _create_sequence_tensor with device: cpu
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Creating tensor on CPU with device: cpu
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR-CPU] Tensor device after creation (patched): cpu, shape: torch.Size([1, 80])
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-SEQ-TENSOR] Output tensor device: cpu, shape: torch.Size([1, 80]), dtype: torch.int64
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] seq_tensor.device: cpu
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][DEBUG] - [DEBUG-PREDICT-ADJACENCY] self.model.device: cpu
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][WARNING] - [UNIQUE-WARN-STAGEA-FORWARD] Error in model forward pass: 'Module' object has no attribute 'shape'
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix shape: (8, 8)
[2025-05-01 11:12:20][rna_predict.pipeline.stageA.adjacency.rfold_predictor][INFO] - Adjacency matrix data type: float32
[2025-05-01 11:12:20][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] Initializing StageCReconstruction
[2025-05-01 11:12:20][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] Memory usage: 368.84 MB
[2025-05-01 11:12:20][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] After super().__init__
[2025-05-01 11:12:20][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - [MEMORY-LOG][StageC] Memory usage: 368.84 MB
[2025-05-01 11:12:20,282][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - Initializing PairformerWrapper...
[2025-05-01 11:12:20,282][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [MEMORY-LOG][StageB-Pairformer] Memory usage: 368.84 MB
[2025-05-01 11:12:20,282][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][WARNING] - Pairformer config missing required keys, entering dummy mode
[2025-05-01 11:12:20,283][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [UNIQUE-INFO-STAGEB-PAIRFORMER-TEST] PairformerWrapper initialized
[2025-05-01 11:12:20,283][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - Initializing Pairformer wrapper with device: cpu
[2025-05-01 11:12:20,283][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][WARNING] - 'use_checkpoint' not found in config, defaulting to False
[2025-05-01 11:12:20,297][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [MEMORY-LOG][StageB-Pairformer] After super().__init__
[2025-05-01 11:12:20,297][rna_predict.pipeline.stageB.pairwise.pairformer_wrapper][INFO] - [MEMORY-LOG][StageB-Pairformer] Memory usage: 370.75 MB


================================================================================
Output from: pipeline/stageC/stage_c_reconstruction.py
Timestamp: 2025-05-01 11:12:20
================================================================================

STDOUT:
[2025-05-01 11:12:22,108][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Debug logging is enabled for StageC.
[2025-05-01 11:12:22,108][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg: {'sequence': '${test_data.sequence}', 'device': 'cpu', 'seed': 42, 'atoms_per_residue': 44, 'run_stageD': True, 'enable_stageC': True, 'merge_latent': True, 'pipeline': {'verbose': True, 'save_intermediates': True, 'output_dir': 'outputs', 'ignore_nan_values': True, 'nan_replacement_value': 0.0}, 'data': {'index_csv': './data/index.csv', 'root_dir': './data/', 'max_residues': 512, 'max_atoms': 4096, 'C_element': 128, 'C_char': 256, 'batch_size': 4, 'num_workers': 8, 'load_adj': False, 'load_ang': False}, 'model': {'stageA': {'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}, 'stageC': {'enabled': True, 'method': 'mp_nerf', 'do_ring_closure': False, 'place_bases': True, 'sugar_pucker': "C3'-endo", 'device': 'cpu', 'debug_logging': True, 'angle_representation': 'degrees', 'use_metadata': False, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}, 'stageB': {'torsion_bert': {'model_name_or_path': 'sayby/rna_torsionbert', 'device': '${device}', 'angle_mode': 'sin_cos', 'num_angles': 7, 'max_length': 512, 'checkpoint_path': None, 'debug_logging': True, 'init_from_scratch': False, 'lora': {'enabled': False, 'r': 8, 'alpha': 16, 'dropout': 0.1, 'target_modules': ['query', 'value']}}, 'pairformer': {'n_blocks': 1, 'n_heads': 1, 'c_z': 2, 'c_s': 2, 'c_token': 384, 'c_atom': 128, 'c_pair': 32, 'dropout': 0.0, 'freeze_params': False, 'device': '${device}', 'protenix_integration': {'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False, 'device': '${device}'}, 'msa': {'c_m': 2, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'n_blocks': 1, 'enable': False, 'strategy': 'random', 'train_cutoff': 1, 'test_cutoff': 1, 'train_lowerb': 1, 'test_lowerb': 1, 'n_heads': 1, 'pair_dropout': 0.0, 'c_s_inputs': 2, 'blocks_per_ckpt': 1, 'input_feature_dims': {'msa': 2, 'has_deletion': 1, 'deletion_value': 1}}, 'template': {'n_blocks': 1, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'blocks_per_ckpt': None, 'input_feature_dims': {'feature1': {'template_distogram': 1, 'b_template_backbone_frame_mask': 1, 'template_unit_vector': 1, 'b_template_pseudo_beta_mask': 1}, 'feature2': {'template_restype_i': 1, 'template_restype_j': 1}}, 'distogram': {'max_bin': 1, 'min_bin': 1, 'no_bins': 1}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'c_hidden_mul': 1, 'c_hidden_pair_att': 2, 'no_heads_pair': 1, 'init_z_from_adjacency': False, 'debug_logging': False, 'lora': {'enabled': False, 'r': 1, 'alpha': 1, 'dropout': 0.0, 'target_modules': ['query', 'value']}}}, 'stageD': {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}, 'protenix_integration': {'device': '${device}', 'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False}}, 'stageD_diffusion': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}, 'test_data': {'sequence': 'ACGUACGU', 'sequence_length': 8, 'atoms_per_residue': 44, 'adjacency_fill_value': 1.0, 'target_dim': 3, 'torsion_angle_dim': 7, 'embedding_dims': {'s_trunk': 384, 'z_trunk': 128, 's_inputs': 449}, 'sequence_path': '${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv', 'data_index': './rna_predict/dataset/examples/kaggle_minimal_index.csv', 'target_id': '1SCL_A', 'model': {'stageD': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}}}}
[2025-05-01 11:12:22,108][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg keys: ['sequence', 'device', 'seed', 'atoms_per_residue', 'run_stageD', 'enable_stageC', 'merge_latent', 'pipeline', 'data', 'model', 'stageD_diffusion', 'test_data']
[2025-05-01 11:12:22,108][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg.model keys: ['stageA', 'stageC', 'stageB', 'stageD', 'protenix_integration']
[2025-05-01 11:12:22,108][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [UNIQUE-DEBUG-STAGEC-TEST] Stage C config validated.
[2025-05-01 11:12:22,109][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - Running Stage C with Hydra configuration:
[2025-05-01 11:12:22,121][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - sequence: ${test_data.sequence}
device: cpu
seed: 42
atoms_per_residue: 44
run_stageD: true
enable_stageC: true
merge_latent: true
pipeline:
  verbose: true
  save_intermediates: true
  output_dir: outputs
  ignore_nan_values: true
  nan_replacement_value: 0.0
data:
  index_csv: ./data/index.csv
  root_dir: ./data/
  max_residues: 512
  max_atoms: 4096
  C_element: 128
  C_char: 256
  batch_size: 4
  num_workers: 8
  load_adj: false
  load_ang: false
model:
  stageA:
    num_hidden: 128
    dropout: 0.3
    min_seq_length: 80
    device: cpu
    checkpoint_path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
    checkpoint_url: https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1
    checkpoint_zip_path: RFold/checkpoints.zip
    batch_size: 32
    lr: 0.001
    threshold: 0.5
    debug_logging: true
    freeze_params: true
    run_example: true
    example_sequence: AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC
    visualization:
      enabled: true
      varna_jar_path: tools/varna-3-93.jar
      resolution: 8.0
      output_path: test_seq.png
    model:
      conv_channels:
      - 64
      - 128
      - 256
      - 512
      residual: true
      c_in: 1
      c_out: 1
      c_hid: 32
      seq2map:
        input_dim: 4
        max_length: 3000
        attention_heads: 8
        attention_dropout: 0.1
        positional_encoding: true
        query_key_dim: 128
        expansion_factor: 2.0
        heads: 1
      decoder:
        up_conv_channels:
        - 256
        - 128
        - 64
        skip_connections: true
  stageC:
    enabled: true
    method: mp_nerf
    do_ring_closure: false
    place_bases: true
    sugar_pucker: C3'-endo
    device: cpu
    debug_logging: true
    angle_representation: degrees
    use_metadata: false
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
  stageB:
    torsion_bert:
      model_name_or_path: sayby/rna_torsionbert
      device: ${device}
      angle_mode: sin_cos
      num_angles: 7
      max_length: 512
      checkpoint_path: null
      debug_logging: true
      init_from_scratch: false
      lora:
        enabled: false
        r: 8
        alpha: 16
        dropout: 0.1
        target_modules:
        - query
        - value
    pairformer:
      n_blocks: 1
      n_heads: 1
      c_z: 2
      c_s: 2
      c_token: 384
      c_atom: 128
      c_pair: 32
      dropout: 0.0
      freeze_params: false
      device: ${device}
      protenix_integration:
        c_token: 449
        restype_dim: 32
        profile_dim: 32
        c_atom: 128
        c_pair: 32
        num_heads: 4
        num_layers: 3
        r_max: 32
        s_max: 2
        use_optimized: false
        device: ${device}
      msa:
        c_m: 2
        c: 2
        c_z: 2
        dropout: 0.0
        n_blocks: 1
        enable: false
        strategy: random
        train_cutoff: 1
        test_cutoff: 1
        train_lowerb: 1
        test_lowerb: 1
        n_heads: 1
        pair_dropout: 0.0
        c_s_inputs: 2
        blocks_per_ckpt: 1
        input_feature_dims:
          msa: 2
          has_deletion: 1
          deletion_value: 1
      template:
        n_blocks: 1
        c: 2
        c_z: 2
        dropout: 0.0
        blocks_per_ckpt: null
        input_feature_dims:
          feature1:
            template_distogram: 1
            b_template_backbone_frame_mask: 1
            template_unit_vector: 1
            b_template_pseudo_beta_mask: 1
          feature2:
            template_restype_i: 1
            template_restype_j: 1
        distogram:
          max_bin: 1
          min_bin: 1
          no_bins: 1
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      c_hidden_mul: 1
      c_hidden_pair_att: 2
      no_heads_pair: 1
      init_z_from_adjacency: false
      debug_logging: false
      lora:
        enabled: false
        r: 1
        alpha: 1
        dropout: 0.0
        target_modules:
        - query
        - value
  stageD:
    enabled: true
    mode: ${stageD_diffusion.diffusion.mode}
    device: ${stageD_diffusion.diffusion.device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      num_layers: 6
      num_heads: 8
      dropout: 0.1
      coord_eps: 1.0e-06
      coord_min: -10000.0
      coord_max: 10000.0
      coord_similarity_rtol: 0.001
      test_residues_per_batch: 25
      sigma_data: 1.0
    transformer:
      n_blocks: ${stageD_diffusion.diffusion.transformer.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.transformer.n_heads}
      blocks_per_ckpt: ${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}
    atom_encoder:
      c_in: ${stageD_diffusion.diffusion.atom_encoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_encoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_encoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_encoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_encoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_encoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_encoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_encoder.n_keys}
    atom_decoder:
      c_in: ${stageD_diffusion.diffusion.atom_decoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_decoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_decoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_decoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_decoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_decoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_decoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_decoder.n_keys}
    diffusion:
      enabled: true
      mode: inference
      device: ${device}
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      test_residues_per_batch: 2
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
        num_layers: 6
        num_heads: 8
        dropout: 0.1
        coord_eps: 1.0e-06
        coord_min: -10000.0
        coord_max: 10000.0
        coord_similarity_rtol: 0.001
        test_residues_per_batch: 25
      transformer:
        n_blocks: 2
        n_heads: 2
        blocks_per_ckpt: null
      atom_encoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      atom_decoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      noise_schedule:
        schedule_type: linear
        s_max: 1.0
        s_min: 0.01
        p: 0.5
        p_mean: 0.0
        p_std: 1.0
      inference:
        num_steps: 2
        temperature: 1.0
        use_ddim: true
        sampling:
          num_samples: 1
          gamma0: 0.8
          gamma_min: 1.0
          noise_scale_lambda: 1.003
          step_scale_eta: 1.5
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      init_from_scratch: false
      feature_dimensions:
        c_s: 8
        c_s_inputs: 8
        c_sing: 8
        s_trunk: 8
        s_inputs: 8
    input_features: null
  protenix_integration:
    device: ${device}
    c_token: 449
    restype_dim: 32
    profile_dim: 32
    c_atom: 128
    c_pair: 32
    num_heads: 4
    num_layers: 3
    r_max: 32
    s_max: 2
    use_optimized: false
stageD_diffusion:
  enabled: true
  debug_logging: true
  ref_element_size: 128
  ref_atom_name_chars_size: 256
  profile_size: 32
  model_architecture:
    c_token: 8
    c_s: 8
    c_z: 4
    c_s_inputs: 8
    c_atom: 4
    c_atompair: 4
    c_noise_embedding: 4
    sigma_data: 1.0
  diffusion:
    init_from_scratch: false
    enabled: true
    mode: inference
    device: ${device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    feature_dimensions:
      c_s: 8
      c_s_inputs: 8
      c_sing: 8
      s_trunk: 8
      s_inputs: 8
    test_residues_per_batch: 2
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      sigma_data: 1.0
    transformer:
      n_blocks: 2
      n_heads: 2
      blocks_per_ckpt: null
    atom_encoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    atom_decoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    noise_schedule:
      schedule_type: linear
      s_max: 1.0
      s_min: 0.01
      p: 0.5
      p_mean: 0.0
      p_std: 1.0
    inference:
      num_steps: 2
      temperature: 1.0
      use_ddim: true
      sampling:
        num_samples: 1
        gamma0: 0.8
        gamma_min: 1.0
        noise_scale_lambda: 1.003
        step_scale_eta: 1.5
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
test_data:
  sequence: ACGUACGU
  sequence_length: 8
  atoms_per_residue: 44
  adjacency_fill_value: 1.0
  target_dim: 3
  torsion_angle_dim: 7
  embedding_dims:
    s_trunk: 384
    z_trunk: 128
    s_inputs: 449
  sequence_path: ${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv
  data_index: ./rna_predict/dataset/examples/kaggle_minimal_index.csv
  target_id: 1SCL_A
  model:
    stageD:
      enabled: true
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
      diffusion:
        init_from_scratch: false
        enabled: true
        mode: inference
        device: ${device}
        debug_logging: true
        ref_element_size: 128
        ref_atom_name_chars_size: 256
        profile_size: 32
        feature_dimensions:
          c_s: 8
          c_s_inputs: 8
          c_sing: 8
          s_trunk: 8
          s_inputs: 8
        test_residues_per_batch: 2
        model_architecture:
          c_token: 8
          c_s: 8
          c_z: 4
          c_s_inputs: 8
          c_atom: 4
          c_atompair: 4
          c_noise_embedding: 4
          sigma_data: 1.0
        transformer:
          n_blocks: 2
          n_heads: 2
          blocks_per_ckpt: null
        atom_encoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        atom_decoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        noise_schedule:
          schedule_type: linear
          s_max: 1.0
          s_min: 0.01
          p: 0.5
          p_mean: 0.0
          p_std: 1.0
        inference:
          num_steps: 2
          temperature: 1.0
          use_ddim: true
          sampling:
            num_samples: 1
            gamma0: 0.8
            gamma_min: 1.0
            noise_scale_lambda: 1.003
            step_scale_eta: 1.5
        use_memory_efficient_kernel: false
        use_deepspeed_evo_attention: false
        use_lma: false
        inplace_safe: false
        chunk_size: null

[2025-05-01 11:12:22,122][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Using standardized test sequence: ACGUACGU with 7 torsion angles
[2025-05-01 11:12:22,122][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - 
Running Stage C for sequence: ACGUACGU
[2025-05-01 11:12:22,122][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Using dummy torsions shape: torch.Size([8, 7])
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg: {'sequence': '${test_data.sequence}', 'device': 'cpu', 'seed': 42, 'atoms_per_residue': 44, 'run_stageD': True, 'enable_stageC': True, 'merge_latent': True, 'pipeline': {'verbose': True, 'save_intermediates': True, 'output_dir': 'outputs', 'ignore_nan_values': True, 'nan_replacement_value': 0.0}, 'data': {'index_csv': './data/index.csv', 'root_dir': './data/', 'max_residues': 512, 'max_atoms': 4096, 'C_element': 128, 'C_char': 256, 'batch_size': 4, 'num_workers': 8, 'load_adj': False, 'load_ang': False}, 'model': {'stageA': {'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}, 'stageC': {'enabled': True, 'method': 'mp_nerf', 'do_ring_closure': False, 'place_bases': True, 'sugar_pucker': "C3'-endo", 'device': 'cpu', 'debug_logging': True, 'angle_representation': 'degrees', 'use_metadata': False, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}, 'stageB': {'torsion_bert': {'model_name_or_path': 'sayby/rna_torsionbert', 'device': '${device}', 'angle_mode': 'sin_cos', 'num_angles': 7, 'max_length': 512, 'checkpoint_path': None, 'debug_logging': True, 'init_from_scratch': False, 'lora': {'enabled': False, 'r': 8, 'alpha': 16, 'dropout': 0.1, 'target_modules': ['query', 'value']}}, 'pairformer': {'n_blocks': 1, 'n_heads': 1, 'c_z': 2, 'c_s': 2, 'c_token': 384, 'c_atom': 128, 'c_pair': 32, 'dropout': 0.0, 'freeze_params': False, 'device': '${device}', 'protenix_integration': {'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False, 'device': '${device}'}, 'msa': {'c_m': 2, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'n_blocks': 1, 'enable': False, 'strategy': 'random', 'train_cutoff': 1, 'test_cutoff': 1, 'train_lowerb': 1, 'test_lowerb': 1, 'n_heads': 1, 'pair_dropout': 0.0, 'c_s_inputs': 2, 'blocks_per_ckpt': 1, 'input_feature_dims': {'msa': 2, 'has_deletion': 1, 'deletion_value': 1}}, 'template': {'n_blocks': 1, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'blocks_per_ckpt': None, 'input_feature_dims': {'feature1': {'template_distogram': 1, 'b_template_backbone_frame_mask': 1, 'template_unit_vector': 1, 'b_template_pseudo_beta_mask': 1}, 'feature2': {'template_restype_i': 1, 'template_restype_j': 1}}, 'distogram': {'max_bin': 1, 'min_bin': 1, 'no_bins': 1}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'c_hidden_mul': 1, 'c_hidden_pair_att': 2, 'no_heads_pair': 1, 'init_z_from_adjacency': False, 'debug_logging': False, 'lora': {'enabled': False, 'r': 1, 'alpha': 1, 'dropout': 0.0, 'target_modules': ['query', 'value']}}}, 'stageD': {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}, 'protenix_integration': {'device': '${device}', 'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False}}, 'stageD_diffusion': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}, 'test_data': {'sequence': 'ACGUACGU', 'sequence_length': 8, 'atoms_per_residue': 44, 'adjacency_fill_value': 1.0, 'target_dim': 3, 'torsion_angle_dim': 7, 'embedding_dims': {'s_trunk': 384, 'z_trunk': 128, 's_inputs': 449}, 'sequence_path': '${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv', 'data_index': './rna_predict/dataset/examples/kaggle_minimal_index.csv', 'target_id': '1SCL_A', 'model': {'stageD': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}}}}
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg keys: ['sequence', 'device', 'seed', 'atoms_per_residue', 'run_stageD', 'enable_stageC', 'merge_latent', 'pipeline', 'data', 'model', 'stageD_diffusion', 'test_data']
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg.model keys: ['stageA', 'stageC', 'stageB', 'stageD', 'protenix_integration']
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [UNIQUE-DEBUG-STAGEC-TEST] Stage C config validated.
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-ENTRY] Entered run_stageC_rna_mpnerf in /Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageC/stage_c_reconstruction.py
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Entered run_stageC_rna_mpnerf
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions.requires_grad: False
[2025-05-01 11:12:22,123][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions.grad_fn: None
[2025-05-01 11:12:22,124][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg: {'sequence': '${test_data.sequence}', 'device': 'cpu', 'seed': 42, 'atoms_per_residue': 44, 'run_stageD': True, 'enable_stageC': True, 'merge_latent': True, 'pipeline': {'verbose': True, 'save_intermediates': True, 'output_dir': 'outputs', 'ignore_nan_values': True, 'nan_replacement_value': 0.0}, 'data': {'index_csv': './data/index.csv', 'root_dir': './data/', 'max_residues': 512, 'max_atoms': 4096, 'C_element': 128, 'C_char': 256, 'batch_size': 4, 'num_workers': 8, 'load_adj': False, 'load_ang': False}, 'model': {'stageA': {'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}, 'stageC': {'enabled': True, 'method': 'mp_nerf', 'do_ring_closure': False, 'place_bases': True, 'sugar_pucker': "C3'-endo", 'device': 'cpu', 'debug_logging': True, 'angle_representation': 'degrees', 'use_metadata': False, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}, 'stageB': {'torsion_bert': {'model_name_or_path': 'sayby/rna_torsionbert', 'device': '${device}', 'angle_mode': 'sin_cos', 'num_angles': 7, 'max_length': 512, 'checkpoint_path': None, 'debug_logging': True, 'init_from_scratch': False, 'lora': {'enabled': False, 'r': 8, 'alpha': 16, 'dropout': 0.1, 'target_modules': ['query', 'value']}}, 'pairformer': {'n_blocks': 1, 'n_heads': 1, 'c_z': 2, 'c_s': 2, 'c_token': 384, 'c_atom': 128, 'c_pair': 32, 'dropout': 0.0, 'freeze_params': False, 'device': '${device}', 'protenix_integration': {'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False, 'device': '${device}'}, 'msa': {'c_m': 2, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'n_blocks': 1, 'enable': False, 'strategy': 'random', 'train_cutoff': 1, 'test_cutoff': 1, 'train_lowerb': 1, 'test_lowerb': 1, 'n_heads': 1, 'pair_dropout': 0.0, 'c_s_inputs': 2, 'blocks_per_ckpt': 1, 'input_feature_dims': {'msa': 2, 'has_deletion': 1, 'deletion_value': 1}}, 'template': {'n_blocks': 1, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'blocks_per_ckpt': None, 'input_feature_dims': {'feature1': {'template_distogram': 1, 'b_template_backbone_frame_mask': 1, 'template_unit_vector': 1, 'b_template_pseudo_beta_mask': 1}, 'feature2': {'template_restype_i': 1, 'template_restype_j': 1}}, 'distogram': {'max_bin': 1, 'min_bin': 1, 'no_bins': 1}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'c_hidden_mul': 1, 'c_hidden_pair_att': 2, 'no_heads_pair': 1, 'init_z_from_adjacency': False, 'debug_logging': False, 'lora': {'enabled': False, 'r': 1, 'alpha': 1, 'dropout': 0.0, 'target_modules': ['query', 'value']}}}, 'stageD': {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}, 'protenix_integration': {'device': '${device}', 'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False}}, 'stageD_diffusion': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}, 'test_data': {'sequence': 'ACGUACGU', 'sequence_length': 8, 'atoms_per_residue': 44, 'adjacency_fill_value': 1.0, 'target_dim': 3, 'torsion_angle_dim': 7, 'embedding_dims': {'s_trunk': 384, 'z_trunk': 128, 's_inputs': 449}, 'sequence_path': '${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv', 'data_index': './rna_predict/dataset/examples/kaggle_minimal_index.csv', 'target_id': '1SCL_A', 'model': {'stageD': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}}}}
[2025-05-01 11:12:22,124][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg keys: ['sequence', 'device', 'seed', 'atoms_per_residue', 'run_stageD', 'enable_stageC', 'merge_latent', 'pipeline', 'data', 'model', 'stageD_diffusion', 'test_data']
[2025-05-01 11:12:22,124][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg.model keys: ['stageA', 'stageC', 'stageB', 'stageD', 'protenix_integration']
[2025-05-01 11:12:22,124][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [UNIQUE-DEBUG-STAGEC-TEST] Stage C config validated.
[2025-05-01 11:12:22,124][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - This should always appear if logger is working. sequence=ACGUACGU, torsion_shape=torch.Size([8, 7])
[2025-05-01 11:12:22,124][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Running MP-NeRF with device=cpu, do_ring_closure=False
[2025-05-01 11:12:22,124][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Sequence length: 8, torsion shape: torch.Size([8, 7])
[2025-05-01 11:12:22,126][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions requires_grad: False
[2025-05-01 11:12:22,126][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions grad_fn: None
[2025-05-01 11:12:22,128][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - scaffolds['torsions'] requires_grad: False
[2025-05-01 11:12:22,128][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - scaffolds['torsions'] grad_fn: None
[2025-05-01 11:12:22,128][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] seq: type=<class 'str'>, shape/len=8
[2025-05-01 11:12:22,132][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] torsions[3] = tensor([-1.9889, -1.2418,  0.9946,  6.9033, -2.5138,  0.5964,  3.1266])
[2025-05-01 11:12:22,132][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] device: type=<class 'str'>, shape/len=3
[2025-05-01 11:12:22,132][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] sugar_pucker: type=<class 'str'>, shape/len=8
[2025-05-01 11:12:22,132][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] bond_mask[3] = tensor([1.5930, 1.6070, 1.5000, 1.5000, 1.4800, 1.4800, 1.4400, 1.5100, 1.4530,
        1.5240])
[2025-05-01 11:12:22,132][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] angles_mask: type=<class 'torch.Tensor'>, shape/len=torch.Size([2, 8, 10])
[2025-05-01 11:12:22,132][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] point_ref_mask: type=<class 'torch.Tensor'>, shape/len=torch.Size([3, 8, 10])
[2025-05-01 11:12:22,132][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] cloud_mask[3] = tensor([True, True, True, True, True, True, True, True, True, True])
[2025-05-01 11:12:22,147][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-BB-COORDS-RES3] coords_bb[3] = tensor([[18.0222, 37.6029, 24.9500],
        [16.6984, 38.4473, 25.2185],
        [16.6579, 37.0285, 25.4611],
        [18.0896, 37.4357, 25.7156],
        [17.2921, 38.6254, 25.9605],
        [16.4299, 37.4242, 26.2133],
        [17.8143, 37.1983, 26.4531],
        [17.6156, 38.6635, 26.7059],
        [16.3838, 38.0135, 26.9440],
        [17.5238, 37.0719, 27.1968]])
[2025-05-01 11:12:22,147][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_bb requires_grad: False
[2025-05-01 11:12:22,147][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_bb grad_fn: None
[2025-05-01 11:12:22,148][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-PLACE_BASES] place_bases: True
[2025-05-01 11:12:22,148][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-GRAD-PRINT-CALLSITE] coords_bb (input to place_rna_bases) requires_grad: False, grad_fn: None
[DEBUG-GRAD-PRINT] backbone_coords (input to place_rna_bases) requires_grad: False, grad_fn: None
[2025-05-01 11:12:22,263][numexpr.utils][INFO] - NumExpr defaulting to 8 threads.
[DEBUG-GRAD-PRINT-BASE-PLACEMENT] full_coords.requires_grad: False, grad_fn: None
[2025-05-01 11:12:22,392][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full (after place_bases) requires_grad: False
[2025-05-01 11:12:22,392][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full (after place_bases) grad_fn: None
[2025-05-01 11:12:22,393][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full_flat requires_grad: False
[2025-05-01 11:12:22,393][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full_flat grad_fn: None
[2025-05-01 11:12:22,393][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Sequence used for atom metadata: ACGUACGU
[2025-05-01 11:12:22,393][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Atom counts for each residue: [22, 20, 23, 20, 22, 20, 23, 20]
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Total atom count: 170
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - sequence length: 8
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full_flat.shape: torch.Size([170, 3])
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - atom_names (len): 170 ['P', 'OP1', 'OP2', "O5'", "C5'", "C4'", "O4'", "C3'", "O3'", "C2'", "O2'", "C1'", 'N9', 'C8', 'N7', 'C5', 'C6', 'N6', 'N1', 'C2']
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - residue_indices (len): 170 [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - valid_atom_mask (sum): 170
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - place_bases: True
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - StageC completed: sequence=ACGUACGU, residues=8, atoms=170, coords_shape=torch.Size([170, 3]), device=cpu, elapsed_time=0.01s
[2025-05-01 11:12:22,394][root][INFO] - ROOT: StageC completed: sequence=ACGUACGU, residues=8, atoms=170, coords_shape=torch.Size([170, 3]), device=cpu, elapsed_time=0.01s
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - output['coords'] shape: torch.Size([170, 3])
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - output['coords_3d'] shape: torch.Size([8, 23, 3])
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - output['atom_count']: 170
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - 
Stage C Output:
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Coords shape: torch.Size([170, 3])
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Coords 3D shape: torch.Size([8, 23, 3])
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Atom count: 170
[2025-05-01 11:12:22,394][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Output device: cpu
STDERR:
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg: {'sequence': '${test_data.sequence}', 'device': 'cpu', 'seed': 42, 'atoms_per_residue': 44, 'run_stageD': True, 'enable_stageC': True, 'merge_latent': True, 'pipeline': {'verbose': True, 'save_intermediates': True, 'output_dir': 'outputs', 'ignore_nan_values': True, 'nan_replacement_value': 0.0}, 'data': {'index_csv': './data/index.csv', 'root_dir': './data/', 'max_residues': 512, 'max_atoms': 4096, 'C_element': 128, 'C_char': 256, 'batch_size': 4, 'num_workers': 8, 'load_adj': False, 'load_ang': False}, 'model': {'stageA': {'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}, 'stageC': {'enabled': True, 'method': 'mp_nerf', 'do_ring_closure': False, 'place_bases': True, 'sugar_pucker': "C3'-endo", 'device': 'cpu', 'debug_logging': True, 'angle_representation': 'degrees', 'use_metadata': False, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}, 'stageB': {'torsion_bert': {'model_name_or_path': 'sayby/rna_torsionbert', 'device': '${device}', 'angle_mode': 'sin_cos', 'num_angles': 7, 'max_length': 512, 'checkpoint_path': None, 'debug_logging': True, 'init_from_scratch': False, 'lora': {'enabled': False, 'r': 8, 'alpha': 16, 'dropout': 0.1, 'target_modules': ['query', 'value']}}, 'pairformer': {'n_blocks': 1, 'n_heads': 1, 'c_z': 2, 'c_s': 2, 'c_token': 384, 'c_atom': 128, 'c_pair': 32, 'dropout': 0.0, 'freeze_params': False, 'device': '${device}', 'protenix_integration': {'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False, 'device': '${device}'}, 'msa': {'c_m': 2, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'n_blocks': 1, 'enable': False, 'strategy': 'random', 'train_cutoff': 1, 'test_cutoff': 1, 'train_lowerb': 1, 'test_lowerb': 1, 'n_heads': 1, 'pair_dropout': 0.0, 'c_s_inputs': 2, 'blocks_per_ckpt': 1, 'input_feature_dims': {'msa': 2, 'has_deletion': 1, 'deletion_value': 1}}, 'template': {'n_blocks': 1, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'blocks_per_ckpt': None, 'input_feature_dims': {'feature1': {'template_distogram': 1, 'b_template_backbone_frame_mask': 1, 'template_unit_vector': 1, 'b_template_pseudo_beta_mask': 1}, 'feature2': {'template_restype_i': 1, 'template_restype_j': 1}}, 'distogram': {'max_bin': 1, 'min_bin': 1, 'no_bins': 1}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'c_hidden_mul': 1, 'c_hidden_pair_att': 2, 'no_heads_pair': 1, 'init_z_from_adjacency': False, 'debug_logging': False, 'lora': {'enabled': False, 'r': 1, 'alpha': 1, 'dropout': 0.0, 'target_modules': ['query', 'value']}}}, 'stageD': {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}, 'protenix_integration': {'device': '${device}', 'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False}}, 'stageD_diffusion': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}, 'test_data': {'sequence': 'ACGUACGU', 'sequence_length': 8, 'atoms_per_residue': 44, 'adjacency_fill_value': 1.0, 'target_dim': 3, 'torsion_angle_dim': 7, 'embedding_dims': {'s_trunk': 384, 'z_trunk': 128, 's_inputs': 449}, 'sequence_path': '${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv', 'data_index': './rna_predict/dataset/examples/kaggle_minimal_index.csv', 'target_id': '1SCL_A', 'model': {'stageD': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}}}}
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg keys: ['sequence', 'device', 'seed', 'atoms_per_residue', 'run_stageD', 'enable_stageC', 'merge_latent', 'pipeline', 'data', 'model', 'stageD_diffusion', 'test_data']
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg.model keys: ['stageA', 'stageC', 'stageB', 'stageD', 'protenix_integration']
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [UNIQUE-DEBUG-STAGEC-TEST] Stage C config validated.
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - Running Stage C with Hydra configuration:
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - sequence: ${test_data.sequence}
device: cpu
seed: 42
atoms_per_residue: 44
run_stageD: true
enable_stageC: true
merge_latent: true
pipeline:
  verbose: true
  save_intermediates: true
  output_dir: outputs
  ignore_nan_values: true
  nan_replacement_value: 0.0
data:
  index_csv: ./data/index.csv
  root_dir: ./data/
  max_residues: 512
  max_atoms: 4096
  C_element: 128
  C_char: 256
  batch_size: 4
  num_workers: 8
  load_adj: false
  load_ang: false
model:
  stageA:
    num_hidden: 128
    dropout: 0.3
    min_seq_length: 80
    device: cpu
    checkpoint_path: RFold/checkpoints/RNAStralign_trainset_pretrained.pth
    checkpoint_url: https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1
    checkpoint_zip_path: RFold/checkpoints.zip
    batch_size: 32
    lr: 0.001
    threshold: 0.5
    debug_logging: true
    freeze_params: true
    run_example: true
    example_sequence: AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC
    visualization:
      enabled: true
      varna_jar_path: tools/varna-3-93.jar
      resolution: 8.0
      output_path: test_seq.png
    model:
      conv_channels:
      - 64
      - 128
      - 256
      - 512
      residual: true
      c_in: 1
      c_out: 1
      c_hid: 32
      seq2map:
        input_dim: 4
        max_length: 3000
        attention_heads: 8
        attention_dropout: 0.1
        positional_encoding: true
        query_key_dim: 128
        expansion_factor: 2.0
        heads: 1
      decoder:
        up_conv_channels:
        - 256
        - 128
        - 64
        skip_connections: true
  stageC:
    enabled: true
    method: mp_nerf
    do_ring_closure: false
    place_bases: true
    sugar_pucker: C3'-endo
    device: cpu
    debug_logging: true
    angle_representation: degrees
    use_metadata: false
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
  stageB:
    torsion_bert:
      model_name_or_path: sayby/rna_torsionbert
      device: ${device}
      angle_mode: sin_cos
      num_angles: 7
      max_length: 512
      checkpoint_path: null
      debug_logging: true
      init_from_scratch: false
      lora:
        enabled: false
        r: 8
        alpha: 16
        dropout: 0.1
        target_modules:
        - query
        - value
    pairformer:
      n_blocks: 1
      n_heads: 1
      c_z: 2
      c_s: 2
      c_token: 384
      c_atom: 128
      c_pair: 32
      dropout: 0.0
      freeze_params: false
      device: ${device}
      protenix_integration:
        c_token: 449
        restype_dim: 32
        profile_dim: 32
        c_atom: 128
        c_pair: 32
        num_heads: 4
        num_layers: 3
        r_max: 32
        s_max: 2
        use_optimized: false
        device: ${device}
      msa:
        c_m: 2
        c: 2
        c_z: 2
        dropout: 0.0
        n_blocks: 1
        enable: false
        strategy: random
        train_cutoff: 1
        test_cutoff: 1
        train_lowerb: 1
        test_lowerb: 1
        n_heads: 1
        pair_dropout: 0.0
        c_s_inputs: 2
        blocks_per_ckpt: 1
        input_feature_dims:
          msa: 2
          has_deletion: 1
          deletion_value: 1
      template:
        n_blocks: 1
        c: 2
        c_z: 2
        dropout: 0.0
        blocks_per_ckpt: null
        input_feature_dims:
          feature1:
            template_distogram: 1
            b_template_backbone_frame_mask: 1
            template_unit_vector: 1
            b_template_pseudo_beta_mask: 1
          feature2:
            template_restype_i: 1
            template_restype_j: 1
        distogram:
          max_bin: 1
          min_bin: 1
          no_bins: 1
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      c_hidden_mul: 1
      c_hidden_pair_att: 2
      no_heads_pair: 1
      init_z_from_adjacency: false
      debug_logging: false
      lora:
        enabled: false
        r: 1
        alpha: 1
        dropout: 0.0
        target_modules:
        - query
        - value
  stageD:
    enabled: true
    mode: ${stageD_diffusion.diffusion.mode}
    device: ${stageD_diffusion.diffusion.device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      num_layers: 6
      num_heads: 8
      dropout: 0.1
      coord_eps: 1.0e-06
      coord_min: -10000.0
      coord_max: 10000.0
      coord_similarity_rtol: 0.001
      test_residues_per_batch: 25
      sigma_data: 1.0
    transformer:
      n_blocks: ${stageD_diffusion.diffusion.transformer.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.transformer.n_heads}
      blocks_per_ckpt: ${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}
    atom_encoder:
      c_in: ${stageD_diffusion.diffusion.atom_encoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_encoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_encoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_encoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_encoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_encoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_encoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_encoder.n_keys}
    atom_decoder:
      c_in: ${stageD_diffusion.diffusion.atom_decoder.c_in}
      c_hidden: ${stageD_diffusion.diffusion.atom_decoder.c_hidden}
      c_out: ${stageD_diffusion.diffusion.atom_decoder.c_out}
      dropout: ${stageD_diffusion.diffusion.atom_decoder.dropout}
      n_blocks: ${stageD_diffusion.diffusion.atom_decoder.n_blocks}
      n_heads: ${stageD_diffusion.diffusion.atom_decoder.n_heads}
      n_queries: ${stageD_diffusion.diffusion.atom_decoder.n_queries}
      n_keys: ${stageD_diffusion.diffusion.atom_decoder.n_keys}
    diffusion:
      enabled: true
      mode: inference
      device: ${device}
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      test_residues_per_batch: 2
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
        num_layers: 6
        num_heads: 8
        dropout: 0.1
        coord_eps: 1.0e-06
        coord_min: -10000.0
        coord_max: 10000.0
        coord_similarity_rtol: 0.001
        test_residues_per_batch: 25
      transformer:
        n_blocks: 2
        n_heads: 2
        blocks_per_ckpt: null
      atom_encoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      atom_decoder:
        c_in: 4
        c_hidden:
        - 8
        c_out: 4
        dropout: 0.1
        n_blocks: 1
        n_heads: 2
        n_queries: 2
        n_keys: 2
      noise_schedule:
        schedule_type: linear
        s_max: 1.0
        s_min: 0.01
        p: 0.5
        p_mean: 0.0
        p_std: 1.0
      inference:
        num_steps: 2
        temperature: 1.0
        use_ddim: true
        sampling:
          num_samples: 1
          gamma0: 0.8
          gamma_min: 1.0
          noise_scale_lambda: 1.003
          step_scale_eta: 1.5
      use_memory_efficient_kernel: false
      use_deepspeed_evo_attention: false
      use_lma: false
      inplace_safe: false
      chunk_size: null
      init_from_scratch: false
      feature_dimensions:
        c_s: 8
        c_s_inputs: 8
        c_sing: 8
        s_trunk: 8
        s_inputs: 8
    input_features: null
  protenix_integration:
    device: ${device}
    c_token: 449
    restype_dim: 32
    profile_dim: 32
    c_atom: 128
    c_pair: 32
    num_heads: 4
    num_layers: 3
    r_max: 32
    s_max: 2
    use_optimized: false
stageD_diffusion:
  enabled: true
  debug_logging: true
  ref_element_size: 128
  ref_atom_name_chars_size: 256
  profile_size: 32
  model_architecture:
    c_token: 8
    c_s: 8
    c_z: 4
    c_s_inputs: 8
    c_atom: 4
    c_atompair: 4
    c_noise_embedding: 4
    sigma_data: 1.0
  diffusion:
    init_from_scratch: false
    enabled: true
    mode: inference
    device: ${device}
    debug_logging: true
    ref_element_size: 128
    ref_atom_name_chars_size: 256
    profile_size: 32
    feature_dimensions:
      c_s: 8
      c_s_inputs: 8
      c_sing: 8
      s_trunk: 8
      s_inputs: 8
    test_residues_per_batch: 2
    model_architecture:
      c_token: 8
      c_s: 8
      c_z: 4
      c_s_inputs: 8
      c_atom: 4
      c_atompair: 4
      c_noise_embedding: 4
      sigma_data: 1.0
    transformer:
      n_blocks: 2
      n_heads: 2
      blocks_per_ckpt: null
    atom_encoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    atom_decoder:
      c_in: 4
      c_hidden:
      - 8
      c_out: 4
      dropout: 0.1
      n_blocks: 1
      n_heads: 2
      n_queries: 2
      n_keys: 2
    noise_schedule:
      schedule_type: linear
      s_max: 1.0
      s_min: 0.01
      p: 0.5
      p_mean: 0.0
      p_std: 1.0
    inference:
      num_steps: 2
      temperature: 1.0
      use_ddim: true
      sampling:
        num_samples: 1
        gamma0: 0.8
        gamma_min: 1.0
        noise_scale_lambda: 1.003
        step_scale_eta: 1.5
    use_memory_efficient_kernel: false
    use_deepspeed_evo_attention: false
    use_lma: false
    inplace_safe: false
    chunk_size: null
test_data:
  sequence: ACGUACGU
  sequence_length: 8
  atoms_per_residue: 44
  adjacency_fill_value: 1.0
  target_dim: 3
  torsion_angle_dim: 7
  embedding_dims:
    s_trunk: 384
    z_trunk: 128
    s_inputs: 449
  sequence_path: ${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv
  data_index: ./rna_predict/dataset/examples/kaggle_minimal_index.csv
  target_id: 1SCL_A
  model:
    stageD:
      enabled: true
      debug_logging: true
      ref_element_size: 128
      ref_atom_name_chars_size: 256
      profile_size: 32
      model_architecture:
        c_token: 8
        c_s: 8
        c_z: 4
        c_s_inputs: 8
        c_atom: 4
        c_atompair: 4
        c_noise_embedding: 4
        sigma_data: 1.0
      diffusion:
        init_from_scratch: false
        enabled: true
        mode: inference
        device: ${device}
        debug_logging: true
        ref_element_size: 128
        ref_atom_name_chars_size: 256
        profile_size: 32
        feature_dimensions:
          c_s: 8
          c_s_inputs: 8
          c_sing: 8
          s_trunk: 8
          s_inputs: 8
        test_residues_per_batch: 2
        model_architecture:
          c_token: 8
          c_s: 8
          c_z: 4
          c_s_inputs: 8
          c_atom: 4
          c_atompair: 4
          c_noise_embedding: 4
          sigma_data: 1.0
        transformer:
          n_blocks: 2
          n_heads: 2
          blocks_per_ckpt: null
        atom_encoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        atom_decoder:
          c_in: 4
          c_hidden:
          - 8
          c_out: 4
          dropout: 0.1
          n_blocks: 1
          n_heads: 2
          n_queries: 2
          n_keys: 2
        noise_schedule:
          schedule_type: linear
          s_max: 1.0
          s_min: 0.01
          p: 0.5
          p_mean: 0.0
          p_std: 1.0
        inference:
          num_steps: 2
          temperature: 1.0
          use_ddim: true
          sampling:
            num_samples: 1
            gamma0: 0.8
            gamma_min: 1.0
            noise_scale_lambda: 1.003
            step_scale_eta: 1.5
        use_memory_efficient_kernel: false
        use_deepspeed_evo_attention: false
        use_lma: false
        inplace_safe: false
        chunk_size: null

[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Using standardized test sequence: ACGUACGU with 7 torsion angles
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - 
Running Stage C for sequence: ACGUACGU
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Using dummy torsions shape: torch.Size([8, 7])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg: {'sequence': '${test_data.sequence}', 'device': 'cpu', 'seed': 42, 'atoms_per_residue': 44, 'run_stageD': True, 'enable_stageC': True, 'merge_latent': True, 'pipeline': {'verbose': True, 'save_intermediates': True, 'output_dir': 'outputs', 'ignore_nan_values': True, 'nan_replacement_value': 0.0}, 'data': {'index_csv': './data/index.csv', 'root_dir': './data/', 'max_residues': 512, 'max_atoms': 4096, 'C_element': 128, 'C_char': 256, 'batch_size': 4, 'num_workers': 8, 'load_adj': False, 'load_ang': False}, 'model': {'stageA': {'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}, 'stageC': {'enabled': True, 'method': 'mp_nerf', 'do_ring_closure': False, 'place_bases': True, 'sugar_pucker': "C3'-endo", 'device': 'cpu', 'debug_logging': True, 'angle_representation': 'degrees', 'use_metadata': False, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}, 'stageB': {'torsion_bert': {'model_name_or_path': 'sayby/rna_torsionbert', 'device': '${device}', 'angle_mode': 'sin_cos', 'num_angles': 7, 'max_length': 512, 'checkpoint_path': None, 'debug_logging': True, 'init_from_scratch': False, 'lora': {'enabled': False, 'r': 8, 'alpha': 16, 'dropout': 0.1, 'target_modules': ['query', 'value']}}, 'pairformer': {'n_blocks': 1, 'n_heads': 1, 'c_z': 2, 'c_s': 2, 'c_token': 384, 'c_atom': 128, 'c_pair': 32, 'dropout': 0.0, 'freeze_params': False, 'device': '${device}', 'protenix_integration': {'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False, 'device': '${device}'}, 'msa': {'c_m': 2, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'n_blocks': 1, 'enable': False, 'strategy': 'random', 'train_cutoff': 1, 'test_cutoff': 1, 'train_lowerb': 1, 'test_lowerb': 1, 'n_heads': 1, 'pair_dropout': 0.0, 'c_s_inputs': 2, 'blocks_per_ckpt': 1, 'input_feature_dims': {'msa': 2, 'has_deletion': 1, 'deletion_value': 1}}, 'template': {'n_blocks': 1, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'blocks_per_ckpt': None, 'input_feature_dims': {'feature1': {'template_distogram': 1, 'b_template_backbone_frame_mask': 1, 'template_unit_vector': 1, 'b_template_pseudo_beta_mask': 1}, 'feature2': {'template_restype_i': 1, 'template_restype_j': 1}}, 'distogram': {'max_bin': 1, 'min_bin': 1, 'no_bins': 1}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'c_hidden_mul': 1, 'c_hidden_pair_att': 2, 'no_heads_pair': 1, 'init_z_from_adjacency': False, 'debug_logging': False, 'lora': {'enabled': False, 'r': 1, 'alpha': 1, 'dropout': 0.0, 'target_modules': ['query', 'value']}}}, 'stageD': {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}, 'protenix_integration': {'device': '${device}', 'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False}}, 'stageD_diffusion': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}, 'test_data': {'sequence': 'ACGUACGU', 'sequence_length': 8, 'atoms_per_residue': 44, 'adjacency_fill_value': 1.0, 'target_dim': 3, 'torsion_angle_dim': 7, 'embedding_dims': {'s_trunk': 384, 'z_trunk': 128, 's_inputs': 449}, 'sequence_path': '${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv', 'data_index': './rna_predict/dataset/examples/kaggle_minimal_index.csv', 'target_id': '1SCL_A', 'model': {'stageD': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}}}}
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg keys: ['sequence', 'device', 'seed', 'atoms_per_residue', 'run_stageD', 'enable_stageC', 'merge_latent', 'pipeline', 'data', 'model', 'stageD_diffusion', 'test_data']
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg.model keys: ['stageA', 'stageC', 'stageB', 'stageD', 'protenix_integration']
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [UNIQUE-DEBUG-STAGEC-TEST] Stage C config validated.
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-ENTRY] Entered run_stageC_rna_mpnerf in /Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageC/stage_c_reconstruction.py
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Entered run_stageC_rna_mpnerf
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions.requires_grad: False
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions.grad_fn: None
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg: {'sequence': '${test_data.sequence}', 'device': 'cpu', 'seed': 42, 'atoms_per_residue': 44, 'run_stageD': True, 'enable_stageC': True, 'merge_latent': True, 'pipeline': {'verbose': True, 'save_intermediates': True, 'output_dir': 'outputs', 'ignore_nan_values': True, 'nan_replacement_value': 0.0}, 'data': {'index_csv': './data/index.csv', 'root_dir': './data/', 'max_residues': 512, 'max_atoms': 4096, 'C_element': 128, 'C_char': 256, 'batch_size': 4, 'num_workers': 8, 'load_adj': False, 'load_ang': False}, 'model': {'stageA': {'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}, 'stageC': {'enabled': True, 'method': 'mp_nerf', 'do_ring_closure': False, 'place_bases': True, 'sugar_pucker': "C3'-endo", 'device': 'cpu', 'debug_logging': True, 'angle_representation': 'degrees', 'use_metadata': False, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}, 'stageB': {'torsion_bert': {'model_name_or_path': 'sayby/rna_torsionbert', 'device': '${device}', 'angle_mode': 'sin_cos', 'num_angles': 7, 'max_length': 512, 'checkpoint_path': None, 'debug_logging': True, 'init_from_scratch': False, 'lora': {'enabled': False, 'r': 8, 'alpha': 16, 'dropout': 0.1, 'target_modules': ['query', 'value']}}, 'pairformer': {'n_blocks': 1, 'n_heads': 1, 'c_z': 2, 'c_s': 2, 'c_token': 384, 'c_atom': 128, 'c_pair': 32, 'dropout': 0.0, 'freeze_params': False, 'device': '${device}', 'protenix_integration': {'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False, 'device': '${device}'}, 'msa': {'c_m': 2, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'n_blocks': 1, 'enable': False, 'strategy': 'random', 'train_cutoff': 1, 'test_cutoff': 1, 'train_lowerb': 1, 'test_lowerb': 1, 'n_heads': 1, 'pair_dropout': 0.0, 'c_s_inputs': 2, 'blocks_per_ckpt': 1, 'input_feature_dims': {'msa': 2, 'has_deletion': 1, 'deletion_value': 1}}, 'template': {'n_blocks': 1, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'blocks_per_ckpt': None, 'input_feature_dims': {'feature1': {'template_distogram': 1, 'b_template_backbone_frame_mask': 1, 'template_unit_vector': 1, 'b_template_pseudo_beta_mask': 1}, 'feature2': {'template_restype_i': 1, 'template_restype_j': 1}}, 'distogram': {'max_bin': 1, 'min_bin': 1, 'no_bins': 1}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'c_hidden_mul': 1, 'c_hidden_pair_att': 2, 'no_heads_pair': 1, 'init_z_from_adjacency': False, 'debug_logging': False, 'lora': {'enabled': False, 'r': 1, 'alpha': 1, 'dropout': 0.0, 'target_modules': ['query', 'value']}}}, 'stageD': {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}, 'protenix_integration': {'device': '${device}', 'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False}}, 'stageD_diffusion': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}, 'test_data': {'sequence': 'ACGUACGU', 'sequence_length': 8, 'atoms_per_residue': 44, 'adjacency_fill_value': 1.0, 'target_dim': 3, 'torsion_angle_dim': 7, 'embedding_dims': {'s_trunk': 384, 'z_trunk': 128, 's_inputs': 449}, 'sequence_path': '${env:DATA_DIR:./data}/kaggle/stanford-rna-3d-folding/train_sequences.csv', 'data_index': './rna_predict/dataset/examples/kaggle_minimal_index.csv', 'target_id': '1SCL_A', 'model': {'stageD': {'enabled': True, 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'diffusion': {'init_from_scratch': False, 'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}}}}}
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg keys: ['sequence', 'device', 'seed', 'atoms_per_residue', 'run_stageD', 'enable_stageC', 'merge_latent', 'pipeline', 'data', 'model', 'stageD_diffusion', 'test_data']
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [validate_stageC_config] cfg.model keys: ['stageA', 'stageC', 'stageB', 'stageD', 'protenix_integration']
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [UNIQUE-DEBUG-STAGEC-TEST] Stage C config validated.
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - This should always appear if logger is working. sequence=ACGUACGU, torsion_shape=torch.Size([8, 7])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Running MP-NeRF with device=cpu, do_ring_closure=False
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Sequence length: 8, torsion shape: torch.Size([8, 7])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions requires_grad: False
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - predicted_torsions grad_fn: None
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - scaffolds['torsions'] requires_grad: False
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - scaffolds['torsions'] grad_fn: None
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] seq: type=<class 'str'>, shape/len=8
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] torsions[3] = tensor([-1.9889, -1.2418,  0.9946,  6.9033, -2.5138,  0.5964,  3.1266])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] device: type=<class 'str'>, shape/len=3
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] sugar_pucker: type=<class 'str'>, shape/len=8
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] bond_mask[3] = tensor([1.5930, 1.6070, 1.5000, 1.5000, 1.4800, 1.4800, 1.4400, 1.5100, 1.4530,
        1.5240])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] angles_mask: type=<class 'torch.Tensor'>, shape/len=torch.Size([2, 8, 10])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] point_ref_mask: type=<class 'torch.Tensor'>, shape/len=torch.Size([3, 8, 10])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-SCAFFOLDS-RES3] cloud_mask[3] = tensor([True, True, True, True, True, True, True, True, True, True])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-BB-COORDS-RES3] coords_bb[3] = tensor([[18.0222, 37.6029, 24.9500],
        [16.6984, 38.4473, 25.2185],
        [16.6579, 37.0285, 25.4611],
        [18.0896, 37.4357, 25.7156],
        [17.2921, 38.6254, 25.9605],
        [16.4299, 37.4242, 26.2133],
        [17.8143, 37.1983, 26.4531],
        [17.6156, 38.6635, 26.7059],
        [16.3838, 38.0135, 26.9440],
        [17.5238, 37.0719, 27.1968]])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_bb requires_grad: False
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_bb grad_fn: None
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-PLACE_BASES] place_bases: True
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - [DEBUG-GRAD-PRINT-CALLSITE] coords_bb (input to place_rna_bases) requires_grad: False, grad_fn: None
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full (after place_bases) requires_grad: False
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full (after place_bases) grad_fn: None
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full_flat requires_grad: False
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full_flat grad_fn: None
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Sequence used for atom metadata: ACGUACGU
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Atom counts for each residue: [22, 20, 23, 20, 22, 20, 23, 20]
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - Total atom count: 170
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - sequence length: 8
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - coords_full_flat.shape: torch.Size([170, 3])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - atom_names (len): 170 ['P', 'OP1', 'OP2', "O5'", "C5'", "C4'", "O4'", "C3'", "O3'", "C2'", "O2'", "C1'", 'N9', 'C8', 'N7', 'C5', 'C6', 'N6', 'N1', 'C2']
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - residue_indices (len): 170 [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - valid_atom_mask (sum): 170
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - place_bases: True
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][INFO] - StageC completed: sequence=ACGUACGU, residues=8, atoms=170, coords_shape=torch.Size([170, 3]), device=cpu, elapsed_time=0.01s
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - output['coords'] shape: torch.Size([170, 3])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - output['coords_3d'] shape: torch.Size([8, 23, 3])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - output['atom_count']: 170
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] - 
Stage C Output:
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Coords shape: torch.Size([170, 3])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Coords 3D shape: torch.Size([8, 23, 3])
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Atom count: 170
[2025-05-01 11:12:22][rna_predict.pipeline.stageC.stage_c_reconstruction][DEBUG] -   Output device: cpu


================================================================================
Output from: pipeline/stageD/run_stageD.py
Timestamp: 2025-05-01 11:12:22
================================================================================

STDOUT:
[HYDRA DEBUG] CWD: /Users/tomriddle1/RNA_PREDICT/rna_predict
[HYDRA DEBUG] SCRIPT DIR: /Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD
[HYDRA DEBUG] sys.path: ['/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD', '/Users/tomriddle1/.local/share/uv/python/cpython-3.10.12-macos-aarch64-none/lib/python310.zip', '/Users/tomriddle1/.local/share/uv/python/cpython-3.10.12-macos-aarch64-none/lib/python3.10', '/Users/tomriddle1/.local/share/uv/python/cpython-3.10.12-macos-aarch64-none/lib/python3.10/lib-dynload', '/Users/tomriddle1/RNA_PREDICT/.venv/lib/python3.10/site-packages', '__editable__.rna_predict-1.0.0.finder.__path_hook__', '/Users/tomriddle1/RNA_PREDICT/auto-type-annotate']
[CONFIG DEBUG] Top-level keys: ['sequence', 'device', 'seed', 'atoms_per_residue', 'run_stageD', 'enable_stageC', 'merge_latent', 'pipeline', 'data', 'model', 'stageD_diffusion', 'test_data']
[CONFIG DEBUG] model keys: ['stageA', 'stageC', 'stageB', 'stageD', 'protenix_integration']
[2025-05-01 11:12:23,764][__main__][DEBUG] - [hydra_main] cfg.model: {'stageA': {'num_hidden': 128, 'dropout': 0.3, 'min_seq_length': 80, 'device': 'cpu', 'checkpoint_path': 'RFold/checkpoints/RNAStralign_trainset_pretrained.pth', 'checkpoint_url': 'https://www.dropbox.com/s/l04l9bf3v6z2tfd/checkpoints.zip?dl=1', 'checkpoint_zip_path': 'RFold/checkpoints.zip', 'batch_size': 32, 'lr': 0.001, 'threshold': 0.5, 'debug_logging': True, 'freeze_params': True, 'run_example': True, 'example_sequence': 'AAGUCUGGUGGACAUUGGCGUCCUGAGGUGUUAAAACCUCUUAUUGCUGACGCCAGAAAGAGAAGAACUUCGGUUCUACUAGUCGACUAUACUACAAGCUUUGGGUGUAUAGCGGCAAGACAACCUGGAUCGGGGGAGGCUAAGGGCGCAAGCCUAUGCUAACCCCGAGCCGAGCUACUGGAGGGCAACCCCCAGAUAGCCGGUGUAGAGCGCGGAAAGGUGUCGGUCAUCCUAUCUGAUAGGUGGCUUGAGGGACGUGCCGUCUCACCCGAAAGGGUGUUUCUAAGGAGGAGCUCCCAAAGGGCAAAUCUUAGAAAAGGGUGUAUACCCUAUAAUUUAACGGCCAGCAGCC', 'visualization': {'enabled': True, 'varna_jar_path': 'tools/varna-3-93.jar', 'resolution': 8.0, 'output_path': 'test_seq.png'}, 'model': {'conv_channels': [64, 128, 256, 512], 'residual': True, 'c_in': 1, 'c_out': 1, 'c_hid': 32, 'seq2map': {'input_dim': 4, 'max_length': 3000, 'attention_heads': 8, 'attention_dropout': 0.1, 'positional_encoding': True, 'query_key_dim': 128, 'expansion_factor': 2.0, 'heads': 1}, 'decoder': {'up_conv_channels': [256, 128, 64], 'skip_connections': True}}}, 'stageC': {'enabled': True, 'method': 'mp_nerf', 'do_ring_closure': False, 'place_bases': True, 'sugar_pucker': "C3'-endo", 'device': 'cpu', 'debug_logging': True, 'angle_representation': 'degrees', 'use_metadata': False, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None}, 'stageB': {'torsion_bert': {'model_name_or_path': 'sayby/rna_torsionbert', 'device': '${device}', 'angle_mode': 'sin_cos', 'num_angles': 7, 'max_length': 512, 'checkpoint_path': None, 'debug_logging': True, 'init_from_scratch': False, 'lora': {'enabled': False, 'r': 8, 'alpha': 16, 'dropout': 0.1, 'target_modules': ['query', 'value']}}, 'pairformer': {'n_blocks': 1, 'n_heads': 1, 'c_z': 2, 'c_s': 2, 'c_token': 384, 'c_atom': 128, 'c_pair': 32, 'dropout': 0.0, 'freeze_params': False, 'device': '${device}', 'protenix_integration': {'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False, 'device': '${device}'}, 'msa': {'c_m': 2, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'n_blocks': 1, 'enable': False, 'strategy': 'random', 'train_cutoff': 1, 'test_cutoff': 1, 'train_lowerb': 1, 'test_lowerb': 1, 'n_heads': 1, 'pair_dropout': 0.0, 'c_s_inputs': 2, 'blocks_per_ckpt': 1, 'input_feature_dims': {'msa': 2, 'has_deletion': 1, 'deletion_value': 1}}, 'template': {'n_blocks': 1, 'c': 2, 'c_z': 2, 'dropout': 0.0, 'blocks_per_ckpt': None, 'input_feature_dims': {'feature1': {'template_distogram': 1, 'b_template_backbone_frame_mask': 1, 'template_unit_vector': 1, 'b_template_pseudo_beta_mask': 1}, 'feature2': {'template_restype_i': 1, 'template_restype_j': 1}}, 'distogram': {'max_bin': 1, 'min_bin': 1, 'no_bins': 1}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'c_hidden_mul': 1, 'c_hidden_pair_att': 2, 'no_heads_pair': 1, 'init_z_from_adjacency': False, 'debug_logging': False, 'lora': {'enabled': False, 'r': 1, 'alpha': 1, 'dropout': 0.0, 'target_modules': ['query', 'value']}}}, 'stageD': {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}, 'protenix_integration': {'device': '${device}', 'c_token': 449, 'restype_dim': 32, 'profile_dim': 32, 'c_atom': 128, 'c_pair': 32, 'num_heads': 4, 'num_layers': 3, 'r_max': 32, 's_max': 2, 'use_optimized': False}}
[2025-05-01 11:12:23,764][__main__][DEBUG] - [hydra_main] cfg.model.stageD: {'enabled': True, 'mode': '${stageD_diffusion.diffusion.mode}', 'device': '${stageD_diffusion.diffusion.device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25, 'sigma_data': 1.0}, 'transformer': {'n_blocks': '${stageD_diffusion.diffusion.transformer.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.transformer.n_heads}', 'blocks_per_ckpt': '${stageD_diffusion.diffusion.transformer.blocks_per_ckpt}'}, 'atom_encoder': {'c_in': '${stageD_diffusion.diffusion.atom_encoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_encoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_encoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_encoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_encoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_encoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_encoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_encoder.n_keys}'}, 'atom_decoder': {'c_in': '${stageD_diffusion.diffusion.atom_decoder.c_in}', 'c_hidden': '${stageD_diffusion.diffusion.atom_decoder.c_hidden}', 'c_out': '${stageD_diffusion.diffusion.atom_decoder.c_out}', 'dropout': '${stageD_diffusion.diffusion.atom_decoder.dropout}', 'n_blocks': '${stageD_diffusion.diffusion.atom_decoder.n_blocks}', 'n_heads': '${stageD_diffusion.diffusion.atom_decoder.n_heads}', 'n_queries': '${stageD_diffusion.diffusion.atom_decoder.n_queries}', 'n_keys': '${stageD_diffusion.diffusion.atom_decoder.n_keys}'}, 'diffusion': {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}, 'input_features': None}
[2025-05-01 11:12:23,765][__main__][INFO] - Running Stage D Standalone Demo
[2025-05-01 11:12:23,765][__main__][DEBUG] - [UNIQUE-DEBUG-STAGED-TEST] Stage D runner started.
[2025-05-01 11:12:23,765][__main__][DEBUG] - Using standardized test sequence: ACGU with 44 atoms per residue
[2025-05-01 11:12:23,765][__main__][DEBUG] - [run_stageD] ENTRY: z_trunk.shape = torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] s_trunk type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] z_trunk type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] s_inputs type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict type: <class 'dict'>
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict['s_trunk'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict['s_inputs'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict['pair'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict['atom_metadata'] type: <class 'dict'>, shape: None
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict['sequence'] type: <class 'str'>, shape: None
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict['atom_to_token_idx'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] input_feature_dict['ref_space_uid'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 3])
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] atom_metadata type: <class 'dict'>
[2025-05-01 11:12:23,767][__main__][DEBUG] - [run_stageD] trunk_embeddings type: <class 'NoneType'>
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] features type: <class 'NoneType'>
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] stage_cfg type: <class 'NoneType'>
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] diffusion_cfg type: <class 'NoneType'>
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] device: None
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] mode: None
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] debug_logging: True
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] s_trunk shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] z_trunk shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] s_inputs shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] num_atoms: 176
[MEMORY-LOG][StageD ENTRY] Memory usage: 167.55 MB
[2025-05-01 11:12:23,768][__main__][DEBUG] - [DEBUG][run_stageD] Starting Stage D implementation
[DEBUG][run_stageD] Starting Stage D implementation
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict at Stage D entry:
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict['s_trunk'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[DEBUG][run_stageD] input_feature_dict['s_trunk'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict['s_inputs'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[DEBUG][run_stageD] input_feature_dict['s_inputs'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict['pair'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 4, 4])
[DEBUG][run_stageD] input_feature_dict['pair'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict['atom_metadata'] type: <class 'dict'>, shape: None
[DEBUG][run_stageD] input_feature_dict['atom_metadata'] type: <class 'dict'>, shape: None
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict['sequence'] type: <class 'str'>, shape: None
[DEBUG][run_stageD] input_feature_dict['sequence'] type: <class 'str'>, shape: None
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict['atom_to_token_idx'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176])
[DEBUG][run_stageD] input_feature_dict['atom_to_token_idx'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [run_stageD] input_feature_dict['ref_space_uid'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 3])
[DEBUG][run_stageD] input_feature_dict['ref_space_uid'] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 3])
[2025-05-01 11:12:23,768][__main__][DEBUG] - [HYDRA-CONF-DEBUG][StageD] Dumping config values before diffusion:
[2025-05-01 11:12:23,769][__main__][DEBUG] -   n_atoms: 176, n_residues: 4
[2025-05-01 11:12:23,769][__main__][DEBUG] -   s_trunk.shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,769][__main__][DEBUG] -   s_inputs.shape: torch.Size([1, 4, 8])
[2025-05-01 11:12:23,769][__main__][DEBUG] -   z_trunk.shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:23,769][__main__][DEBUG] -   atom_metadata keys: ['residue_indices', 'atom_type', 'is_backbone']
[2025-05-01 11:12:23,769][__main__][DEBUG] -   context.device: None
[2025-05-01 11:12:23,769][__main__][DEBUG] -   context.mode: None
[2025-05-01 11:12:23,769][__main__][DEBUG] -   context.debug_logging: True
[2025-05-01 11:12:23,769][__main__][DEBUG] - [HYDRA-CONF-DEBUG][StageD] END CONFIG DUMP
[2025-05-01 11:12:23,870][numexpr.utils][INFO] - NumExpr defaulting to 8 threads.
[2025-05-01 11:12:23,967][rna_predict.utils.tensor_utils.types][DEBUG] - Expanded residue embeddings torch.Size([4, 8]) to atom embeddings torch.Size([176, 8])
[2025-05-01 11:12:23,967][__main__][DEBUG] - [HYDRA-CONF-BRIDGE][StageD] Bridged s_trunk to atom-level: torch.Size([1, 176, 8])
[MEMORY-LOG][Before bridging residue-to-atom] Memory usage: 213.62 MB
[MEMORY-LOG][After bridging residue-to-atom] Memory usage: 213.97 MB
[MEMORY-LOG][Before diffusion] Memory usage: 213.97 MB
[2025-05-01 11:12:23,969][__main__][DEBUG] - [run_stageD] Calling unified Stage D runner with DiffusionConfig.
[2025-05-01 11:12:24,119] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to mps (auto detect)
[2025-05-01 11:12:26,648][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][INFO] - [StageD] Initializing ProtenixDiffusionManager
[2025-05-01 11:12:26,648][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][INFO] - [StageD] Memory usage: 330.15 MB
[2025-05-01 11:12:26,649][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [StageD] ProtenixDiffusionManager.__init__: cfg.model.stageD.diffusion.device=cpu
[2025-05-01 11:12:26,649][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [StageD] ProtenixDiffusionManager.__init__: full cfg.model.stageD.diffusion={'enabled': True, 'mode': 'inference', 'device': 'cpu', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}
[2025-05-01 11:12:26,650][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [StageD] from_hydra_cfg: stage_cfg.device=cpu
[DEBUG][_parse_diffusion_module_args] stage_cfg: {'enabled': True, 'mode': 'inference', 'device': '${device}', 'debug_logging': True, 'ref_element_size': 128, 'ref_atom_name_chars_size': 256, 'profile_size': 32, 'test_residues_per_batch': 2, 'model_architecture': {'c_token': 8, 'c_s': 8, 'c_z': 4, 'c_s_inputs': 8, 'c_atom': 4, 'c_atompair': 4, 'c_noise_embedding': 4, 'sigma_data': 1.0, 'num_layers': 6, 'num_heads': 8, 'dropout': 0.1, 'coord_eps': 1e-06, 'coord_min': -10000.0, 'coord_max': 10000.0, 'coord_similarity_rtol': 0.001, 'test_residues_per_batch': 25}, 'transformer': {'n_blocks': 2, 'n_heads': 2, 'blocks_per_ckpt': None}, 'atom_encoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'atom_decoder': {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}, 'noise_schedule': {'schedule_type': 'linear', 's_max': 1.0, 's_min': 0.01, 'p': 0.5, 'p_mean': 0.0, 'p_std': 1.0}, 'inference': {'num_steps': 2, 'temperature': 1.0, 'use_ddim': True, 'sampling': {'num_samples': 1, 'gamma0': 0.8, 'gamma_min': 1.0, 'noise_scale_lambda': 1.003, 'step_scale_eta': 1.5}}, 'use_memory_efficient_kernel': False, 'use_deepspeed_evo_attention': False, 'use_lma': False, 'inplace_safe': False, 'chunk_size': None, 'init_from_scratch': False, 'feature_dimensions': {'c_s': 8, 'c_s_inputs': 8, 'c_sing': 8, 's_trunk': 8, 's_inputs': 8}}
[2025-05-01 11:12:26,650][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [StageD] DiffusionManagerConfig.__init__: device=cpu
[2025-05-01 11:12:26,650][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [StageD] ProtenixDiffusionManager.__init__: self.config.device=cpu
[2025-05-01 11:12:26,651][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - Instantiating DiffusionConditioning with: sigma_data=1.0, c_z=4, c_s=8, c_s_inputs=8, c_noise_embedding=4, debug_logging=True
[DEBUG][DiffusionConditioning.__init__] c_z=4, c_s=8, c_s_inputs=8, c_noise_embedding=4
[DEBUG][DiffusionConditioning] expected_z_dim: 8
[DEBUG][DiffusionConditioning] layernorm_s normalized_shape: 16
[DEBUG][DiffusionConditioning] layernorm_n normalized_shape: 4
[2025-05-01 11:12:26,652][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - encoder_config_dict: {'c_in': 4, 'c_hidden': [8], 'c_out': 4, 'dropout': 0.1, 'n_blocks': 1, 'n_heads': 2, 'n_queries': 2, 'n_keys': 2}
[2025-05-01 11:12:26,653][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion][DEBUG] - Initialized DiffusionTransformer with 1 blocks, 2 heads, dimensions: c_a=4, c_s=8, c_z=4
[2025-05-01 11:12:26,654][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion][DEBUG] - Initialized DiffusionTransformer with 2 blocks, 2 heads, dimensions: c_a=8, c_s=8, c_z=4
[2025-05-01 11:12:26,655][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion][DEBUG] - Initialized DiffusionTransformer with 1 blocks, 2 heads, dimensions: c_a=4, c_s=8, c_z=4
[2025-05-01 11:12:26,657][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - DiffusionModule config: enabled: true
mode: inference
device: ${device}
debug_logging: true
ref_element_size: 128
ref_atom_name_chars_size: 256
profile_size: 32
test_residues_per_batch: 2
model_architecture:
  c_token: 8
  c_s: 8
  c_z: 4
  c_s_inputs: 8
  c_atom: 4
  c_atompair: 4
  c_noise_embedding: 4
  sigma_data: 1.0
  num_layers: 6
  num_heads: 8
  dropout: 0.1
  coord_eps: 1.0e-06
  coord_min: -10000.0
  coord_max: 10000.0
  coord_similarity_rtol: 0.001
  test_residues_per_batch: 25
transformer:
  n_blocks: 2
  n_heads: 2
  blocks_per_ckpt: null
atom_encoder:
  c_in: 4
  c_hidden:
  - 8
  c_out: 4
  dropout: 0.1
  n_blocks: 1
  n_heads: 2
  n_queries: 2
  n_keys: 2
atom_decoder:
  c_in: 4
  c_hidden:
  - 8
  c_out: 4
  dropout: 0.1
  n_blocks: 1
  n_heads: 2
  n_queries: 2
  n_keys: 2
noise_schedule:
  schedule_type: linear
  s_max: 1.0
  s_min: 0.01
  p: 0.5
  p_mean: 0.0
  p_std: 1.0
inference:
  num_steps: 2
  temperature: 1.0
  use_ddim: true
  sampling:
    num_samples: 1
    gamma0: 0.8
    gamma_min: 1.0
    noise_scale_lambda: 1.003
    step_scale_eta: 1.5
use_memory_efficient_kernel: false
use_deepspeed_evo_attention: false
use_lma: false
inplace_safe: false
chunk_size: null
init_from_scratch: false
feature_dimensions:
  c_s: 8
  c_s_inputs: 8
  c_sing: 8
  s_trunk: 8
  s_inputs: 8

[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [StageD] After super().__init__
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][INFO] - [StageD] Memory usage after initialization: 331.56 MB
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][INFO] - [HYDRA-CONF-DEBUG][StageD] Using num_steps from config: 2
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.context_objects][DEBUG] - [DEBUG][get_s_inputs] trunk_embeddings keys: ['s_trunk', 's_inputs', 'pair']
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.context_objects][DEBUG] - [EmbeddingContext] Initial z_trunk shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][INFO] - [StageD] z_trunk shape at entry: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [multi_step_inference] coords_init shape: torch.Size([1, 176, 3])
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [multi_step_inference] s_trunk shape: torch.Size([1, 176, 8])
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [multi_step_inference] s_inputs shape: torch.Size([1, 176, 8])
[2025-05-01 11:12:26,658][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [multi_step_inference] z_trunk shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:26,659][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] - [multi_step_inference] Before sample_diffusion:
[2025-05-01 11:12:26,659][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] -   coords_init shape: torch.Size([1, 176, 3])
[2025-05-01 11:12:26,659][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] -   s_trunk shape: torch.Size([1, 176, 8])
[2025-05-01 11:12:26,660][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] -   noise_schedule (len=3): tensor([1.0000, 0.5000, 0.0000])
[2025-05-01 11:12:26,660][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] -   num_steps from config: 2
[2025-05-01 11:12:26,660][rna_predict.pipeline.stageD.diffusion.protenix_diffusion_manager][DEBUG] -   schedule_type from config: linear
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] DiffusionModule.forward: x_noisy device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] t_hat_noise_level device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] s_trunk device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] s_inputs device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] z_trunk device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[ref_charge] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[ref_pos] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[atom_to_token_idx] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[ref_mask] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[ref_element] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[ref_atom_name_chars] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[ref_space_uid] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEVICE-DEBUG][StageD] processed_input_dict[profile] device=cpu
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG][DiffusionModule.forward] atom_to_token_idx type: <class 'torch.Tensor'>, shape: torch.Size([1, 176])
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG][DiffusionModule.forward] atom_to_token_idx tensor shape: torch.Size([1, 176])
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG][DiffusionModule.forward] Calling f_forward with input_feature_dict['atom_to_token_idx']: tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3]])
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] Processed x_noisy shape: torch.Size([1, 1, 176, 3])
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] Processed t_hat_noise_level shape: torch.Size([1, 1])
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] Processed s_trunk shape: torch.Size([1, 176, 8])
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] Processed s_inputs shape: torch.Size([1, 176, 8])
[2025-05-01 11:12:26,662][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] Processed z_trunk shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:26,663][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] EDM factors shapes - c_in: torch.Size([1, 1, 1, 1]), c_skip: torch.Size([1, 1, 1, 1]), c_out: torch.Size([1, 1, 1, 1])
[2025-05-01 11:12:26,663][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] r_noisy shape after scaling: torch.Size([1, 1, 176, 3])
[2025-05-01 11:12:26,663][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG][DiffusionModule.f_forward] Entry: input_feature_dict['atom_to_token_idx']: tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3]])
[2025-05-01 11:12:26,663][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG][DiffusionModule.f_forward] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176]), value: 
[STAGED DEBUG] DiffusionConditioning.forward: c_s=8, c_s_inputs=8, expected_in_features=16
[STAGED DEBUG] s_trunk.shape=torch.Size([1, 176, 8]), s_inputs.shape=torch.Size([1, 176, 8])
[DEVICE-DEBUG][StageD] _ensure_input_feature_dict: using device cpu
[DEBUG][_process_pair_features] z_trunk.shape=torch.Size([1, 4, 4, 4]), relpe_output.shape=torch.Size([1, 4, 4, 4])
[DEBUG][_process_pair_features] pair_z.shape before layernorm_z=torch.Size([1, 4, 4, 8])
[STAGED DEBUG] _process_single_features: s_trunk.shape=torch.Size([1, 176, 8]), s_inputs.shape=torch.Size([1, 176, 8]), c_s=8, c_s_inputs=8, expected_in_features=16
[STAGED DEBUG] After concat: single_s.shape=torch.Size([1, 176, 16])
[STAGED DEBUG] After linear_no_bias_s: single_s.shape=torch.Size([1, 176, 8])
[STAGED DEBUG] After transitions: single_s.shape=torch.Size([1, 176, 8])
[2025-05-01 11:12:26,666][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG] After conditioning - s_single shape: torch.Size([1, 176, 8]), z_pair shape: torch.Size([1, 4, 4, 4])
[2025-05-01 11:12:26,667][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG][DiffusionModule.f_forward] Before _run_with_checkpointing: input_feature_dict['atom_to_token_idx']: tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3]])
[2025-05-01 11:12:26,667][rna_predict.pipeline.stageD.diffusion.components.diffusion_module][DEBUG] - [DEBUG][DiffusionModule.f_forward] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176]), value: 
[DEBUG][AtomAttentionEncoder.forward] Entry: input_feature_dict['atom_to_token_idx']: tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
         2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
         3, 3, 3, 3, 3, 3, 3, 3]])
[DEBUG][AtomAttentionEncoder.forward] type: <class 'torch.Tensor'>, shape: torch.Size([1, 176]), value: 
[DEBUG][extract_atom_features] input_feature_dict keys: ['ref_charge', 'ref_pos', 'atom_to_token_idx', 'ref_mask', 'ref_element', 'ref_atom_name_chars', 'ref_space_uid', 'profile', 'expected_n_tokens']
    key: ref_charge, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 1])
    key: ref_pos, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 3])
    key: atom_to_token_idx, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176])
    key: ref_mask, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 1])
    key: ref_element, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 128])
    key: ref_atom_name_chars, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 256])
    key: ref_space_uid, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 3])
    key: profile, type: <class 'torch.Tensor'>, shape: torch.Size([1, 176, 32])
    key: expected_n_tokens, type: <class 'int'>, shape: None
[DEBUG][extract_atom_features] returning c_l type: <class 'torch.Tensor'> shape: torch.Size([1, 176, 4]) value: tensor([[[ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364],
         [ 0.0182,  0.0227,  0.0196, -0.0364]]], grad_fn=<UnsafeViewBackward0>)
[DEBUG][AtomAttentionEncoder.forward_debug] Extracted c_l shape: torch.Size([1, 176, 4])
[2025-05-01 11:12:28,258][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic][DEBUG] - [process_inputs_with_coords] p_lm is 4D, unsqueezing to 5D. Shape before: torch.Size([1, 176, 176, 4])
[2025-05-01 11:12:28,260][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic][DEBUG] - [DEBUG][CALL] _process_style_embedding c_l.shape=torch.Size([1, 176, 4]) s.shape=torch.Size([1, 176, 8]) atom_to_token_idx.shape=None
[2025-05-01 11:12:28,260][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic][DEBUG] - [process_inputs_with_coords] q_l.shape=torch.Size([1, 176, 4]) c_l.shape=torch.Size([1, 176, 4])
[2025-05-01 11:12:28,275][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal][DEBUG] - [prep_qkv] q.shape before reshape: torch.Size([1, 176, 4])
[2025-05-01 11:12:28,275][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal][DEBUG] - [prep_qkv] num_heads=2, head_dim=2
[2025-05-01 11:12:28,275][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal][DEBUG] - [prep_qkv] expected last dim: 4
[2025-05-01 11:12:28,289][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_weights][DEBUG] - q.shape: torch.Size([2, 176, 2]), k.shape: torch.Size([2, 176, 2]), v.shape: torch.Size([2, 176, 2])
[2025-05-01 11:12:28,291][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal][DEBUG] - [wrap_up] o.shape=torch.Size([1, 176, 2, 2]), c_hidden=4
[2025-05-01 11:12:28,293][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic][DEBUG] - [process_inputs_with_coords] POST-TRANSFORMER q_l.shape=torch.Size([1, 176, 4])
[2025-05-01 11:12:28,293][rna_predict.pipeline.stageD.stage_d_utils.output_utils][ERROR] - Diffusion inference failed for Stage D context (sequence: None)
Traceback (most recent call last):
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/stage_d_utils/output_utils.py", line 37, in run_diffusion_and_handle_output
    result = diffusion_manager.multi_step_inference(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/protenix_diffusion_manager.py", line 477, in multi_step_inference
    coords_final = sample_diffusion(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/generator.py", line 300, in sample_diffusion
    return _chunk_sample_diffusion(N_sample, inplace_safe)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/generator.py", line 267, in _chunk_sample_diffusion
    denoise_result = denoise_net(
  File "/Users/tomriddle1/RNA_PREDICT/.venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/tomriddle1/RNA_PREDICT/.venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/components/diffusion_module.py", line 828, in forward
    r_update = self.f_forward(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/components/diffusion_module.py", line 435, in f_forward
    a_token, q_skip, c_skip, p_skip = self._run_with_checkpointing(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/components/diffusion_module.py", line 296, in _run_with_checkpointing
    return module(*args, **kwargs)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageA/input_embedding/current/transformer/atom_attention_encoder.py", line 231, in forward_debug
    return process_inputs_with_coords(self, process_params)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageA/input_embedding/current/transformer/encoder_components/forward_logic.py", line 444, in process_inputs_with_coords
    raise ValueError("atom_to_token_idx must be a Tensor and not None")
ValueError: atom_to_token_idx must be a Tensor and not None
[2025-05-01 11:12:28,298][__main__][ERROR] - Error during Stage D execution: Failed to run diffusion inference
STDERR:
W0501 11:12:25.112000 8603700288 torch/distributed/elastic/multiprocessing/redirects.py:27] NOTE: Redirects are currently not supported in Windows or MacOs.
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion] Initialized DiffusionTransformer with 1 blocks, 2 heads, dimensions: c_a=4, c_s=8, c_z=4
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion] Initialized DiffusionTransformer with 1 blocks, 2 heads, dimensions: c_a=4, c_s=8, c_z=4
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion] Initialized DiffusionTransformer with 2 blocks, 2 heads, dimensions: c_a=8, c_s=8, c_z=4
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion] Initialized DiffusionTransformer with 2 blocks, 2 heads, dimensions: c_a=8, c_s=8, c_z=4
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion] Initialized DiffusionTransformer with 1 blocks, 2 heads, dimensions: c_a=4, c_s=8, c_z=4
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.diffusion] Initialized DiffusionTransformer with 1 blocks, 2 heads, dimensions: c_a=4, c_s=8, c_z=4
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [process_inputs_with_coords] p_lm is 4D, unsqueezing to 5D. Shape before: torch.Size([1, 176, 176, 4])
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [process_inputs_with_coords] p_lm is 4D, unsqueezing to 5D. Shape before: torch.Size([1, 176, 176, 4])
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [DEBUG][CALL] _process_style_embedding c_l.shape=torch.Size([1, 176, 4]) s.shape=torch.Size([1, 176, 8]) atom_to_token_idx.shape=None
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [DEBUG][CALL] _process_style_embedding c_l.shape=torch.Size([1, 176, 4]) s.shape=torch.Size([1, 176, 8]) atom_to_token_idx.shape=None
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [process_inputs_with_coords] q_l.shape=torch.Size([1, 176, 4]) c_l.shape=torch.Size([1, 176, 4])
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [process_inputs_with_coords] q_l.shape=torch.Size([1, 176, 4]) c_l.shape=torch.Size([1, 176, 4])
/Users/tomriddle1/RNA_PREDICT/.venv/lib/python3.10/site-packages/torch/utils/checkpoint.py:464: UserWarning: torch.utils.checkpoint: the use_reentrant parameter should be passed explicitly. In version 2.4 we will raise an exception if use_reentrant is not passed. use_reentrant=False is recommended, but if you need to preserve the current default behavior, you can pass use_reentrant=True. Refer to docs for more details on the differences between the two variants.
  warnings.warn(
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal] [prep_qkv] q.shape before reshape: torch.Size([1, 176, 4])
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal] [prep_qkv] num_heads=2, head_dim=2
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal] [prep_qkv] expected last dim: 4
/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageA/input_embedding/current/primitives/attention_processing.py:176: UserWarning: Could not reshape attn_bias from torch.Size([1, 1, 2, 176, 176]) to match attention weights. Error: expand(torch.FloatTensor{[1, 1, 1, 2, 176, 176]}, size=[-1, 2, -1, -1]): the number of sizes provided (4) must be greater or equal to the number of dimensions in the tensor (6)
  warnings.warn(
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_weights] q.shape: torch.Size([2, 176, 2]), k.shape: torch.Size([2, 176, 2]), v.shape: torch.Size([2, 176, 2])
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.primitives.attention_utils_internal] [wrap_up] o.shape=torch.Size([1, 176, 2, 2]), c_hidden=4
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [process_inputs_with_coords] POST-TRANSFORMER q_l.shape=torch.Size([1, 176, 4])
[DEBUG][rna_predict.pipeline.stageA.input_embedding.current.transformer.encoder_components.forward_logic] [process_inputs_with_coords] POST-TRANSFORMER q_l.shape=torch.Size([1, 176, 4])
Error executing job with overrides: ['test_data.sequence=ACGUACGU']
Traceback (most recent call last):
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/stage_d_utils/output_utils.py", line 37, in run_diffusion_and_handle_output
    result = diffusion_manager.multi_step_inference(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/protenix_diffusion_manager.py", line 477, in multi_step_inference
    coords_final = sample_diffusion(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/generator.py", line 300, in sample_diffusion
    return _chunk_sample_diffusion(N_sample, inplace_safe)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/generator.py", line 267, in _chunk_sample_diffusion
    denoise_result = denoise_net(
  File "/Users/tomriddle1/RNA_PREDICT/.venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/Users/tomriddle1/RNA_PREDICT/.venv/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/components/diffusion_module.py", line 828, in forward
    r_update = self.f_forward(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/components/diffusion_module.py", line 435, in f_forward
    a_token, q_skip, c_skip, p_skip = self._run_with_checkpointing(
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/diffusion/components/diffusion_module.py", line 296, in _run_with_checkpointing
    return module(*args, **kwargs)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageA/input_embedding/current/transformer/atom_attention_encoder.py", line 231, in forward_debug
    return process_inputs_with_coords(self, process_params)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageA/input_embedding/current/transformer/encoder_components/forward_logic.py", line 444, in process_inputs_with_coords
    raise ValueError("atom_to_token_idx must be a Tensor and not None")
ValueError: atom_to_token_idx must be a Tensor and not None

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/run_stageD.py", line 379, in hydra_main
    _run_stageD_main_logic_context(context)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/run_stageD.py", line 473, in _run_stageD_main_logic_context
    refined_coords = _run_stageD_impl(context)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/run_stageD.py", line 282, in _run_stageD_impl
    _run_diffusion_step(context)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/run_stageD.py", line 175, in _run_diffusion_step
    run_diffusion_and_handle_output(context)
  File "/Users/tomriddle1/RNA_PREDICT/rna_predict/pipeline/stageD/stage_d_utils/output_utils.py", line 44, in run_diffusion_and_handle_output
    raise DiffusionInferenceError("Failed to run diffusion inference") from err
rna_predict.pipeline.stageD.stage_d_utils.output_utils.DiffusionInferenceError: Failed to run diffusion inference

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.

--- PROCESS EXITED WITH ERROR CODE: 1 ---


================================================================================
Output from: interface.py
Timestamp: 2025-05-01 11:12:28
================================================================================

